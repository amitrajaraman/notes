%!TEX root = ./main.tex

\section{Social Choice}

\subsection{Introduction}

	Mechanism design is something of an inverse of game theory, where our task is to set the rules of the game given the desired objects/outcomes.\\
	Some common examples of this are elections, resource allocation, matching students to universities, etc.

	Let $N$ be a set of players, $X$ a set of outcomes, and $\Theta_i$ a set of private information of each agent $i$. Each element $\theta_i \in \Theta_i$ is called a \emph{type}.\\

	The type manifests in the preferences over the outcomes. We shall look at two ways this can happen.
	\begin{enumerate}
	 	\item \emph{Ordinal}: $\theta_i$ defines an ordering over the outcomes, which describes a preference order. It does not describe how much something is preferred, however.
	 	\item \emph{Cardinal}: A utility function $u_i$ maps an outcome/type pair to real numbers. In the \emph{private value model}, $u_i$ is a map $X \times \Theta_i \to \R$. In the \emph{interdependent value model}, $(u_i)_{i \in N}$ is a map $X \times \Theta \to \R$.
	\end{enumerate}

	\begin{fex}
		Let us look at the example of voting. Here, $X$ is the set of candidates, and each $\theta_i$ is a ranking over the candidates. For example, $(a,b,c)$ means that the voter prefers $a$ over $b$ over $c$. \\
		Another example is single object allocation. Each outcome is $x = (a,p) \in X$, where $a = (a_1,\ldots,a_n)$, where each $a_i \in \{0,1\}$ and at most one of the $a_i$s is $1$, and $p = (p_1,\ldots,p_n)$ where $p_i$ is the payment charged to $i$. $\theta_i$ is the amount $i$ values the object. The utility is given by $u_i(x,\theta_i) = a_i\theta_i - p_i$. We shall study this in more detail later in \Cref{sec: mechanism design w transfers}.
	\end{fex}

	Now, the designer has a certain objective captured by a \emph{social choice function} (SCF) $f : \Theta_1 \times \cdots \times \Theta_n \to X$. For example, in voting, if there is a candidate who beats everyone else in pairwise contests, we would like him to be chosen as the winner. In public project choice, where $\theta_i : X \to \R$ is the value of each project, we should pick $f(\theta) = \argmax_{x \in X} \sum_{i \in N} \theta_i(x)$.\\
	To create a game where $f(\theta)$ emerges as the outcome as an equilibrium, we require mechanism design.

	\begin{fdef}
		A(n indirect) mechanism is a collection of message spaces and a decision rule $\langle M_1,\ldots,M_n,g\rangle$, where $M_i$ is the message space of agent $i$, and $g : M_1 \times \cdots \times M_n \to X$. A direct mechanism is the specific case where $M_i = \Theta_i$ and $g \equiv f$.
	\end{fdef}

	We shall see soon that it suffices to look at direct mechanisms.\\
	All subsequent definitions assume cardinal preferences, but they can be replaced with ordinal preferences quite simply.

	\begin{fdef}
		In a mechanism $\langle M_1,\ldots,M_n,g\rangle$, a message $m_i$ is \emph{weakly dominant} for player $i$ at $\theta_i$ if
		\begin{equation}
			\label{eqn: weakly dominant}
			u_i(g(m_i,\widetilde{m}_{-i}),\theta_i) \ge u_i(g(m_i',\widetilde{m}_{-i}),\theta_i)
		\end{equation}
		for all $\widetilde{m}_{-i},m_i'$.
	\end{fdef}

	\begin{fdef}[Dominant strategy implementability]
		 An SCF $f : \Theta \to X$ is \emph{implemented} in dominant strategies by $\langle M_1,\ldots,M_n,g\rangle$ if
		 \begin{enumerate}
		 	\item there exists a message mapping $s_i : \Theta_i \to M_i$ such that $s_i(\theta_i)$ is a dominant strategy for agent $i$ at $\theta_i$, and
		 	\item $g(s_1(\theta_1),\ldots,s_n(\theta_n)) = f(\theta)$ for all $\theta \in \Theta$.
		 \end{enumerate}
		We say that SCF $f$ is \emph{dominant strategy implementable} (DSI) by $\langle M_1,\ldots,M_n,g\rangle$.
	\end{fdef}

	\begin{fdef}[Dominant strategy incentive compatibility]
		\label{def: dsic}
		A direct mechanism $\langle \Theta_1,\ldots,\Theta_n,f\rangle$ is \emph{dominant strategy incentive compatible} (DSIC) if
		\begin{equation}
			\label{eqn: dsic}
			u_i(f(\theta_i,\theta_{-i}),\theta_i) \ge u_i(f(\theta_i',\theta_{-i}),\theta_i)
		\end{equation}
		for all $\theta_i,\theta_i',\widetilde{\theta}_{-i},i$.
	\end{fdef}

	To determine if an SCF $f$ is DSI, it seems that we must search over all possible indirect mechanisms.

	\begin{ftheo}[Revelation principle]
		If there exists an indirect mechanism that implements $f$ in dominant strategies, then $f$ is DSIC.
	\end{ftheo}
	This means that we can focus on DSIC mechanisms without loss of generality.
	\begin{proof}
		Let $f$ be implemented by $\langle M_1,\ldots,M_n,g\rangle$, and fix $s_i : \Theta_i \to M_i$ as in the definition. Set $m_i' = s_i(\theta_i'), \widetilde{m}_{-i} = s_{-i}(\widetilde{\theta}_{-i})$ in \Cref{eqn: weakly dominant}, to get
		\[ u_i(\underbrace{g(s_i(\theta_i),s_{-i}(\widetilde{\theta}_{-i}))}_{f(\theta_i,\widetilde\theta_{-i})},\theta_i) \ge u_i(\underbrace{g(s_i(\theta_i'),s_{-i}(\widetilde\theta_{-i}))}_{f(\theta_i',\widetilde\theta_{-i})},\theta_i), \]
		so $f$ is DSIC.
	\end{proof}

	Now, let us look at a Bayesian extension, where agents may have probabilistic information about others' types. Recall \hyperref[def: bayesian game]{bayesian games}.

	\begin{fdef}[Bayesian implementability]
		A(n indirect) mechanism $\langle M_1,\ldots,M_n,g\rangle$ implements an SCF $f$ in \emph{Bayesian equilibrium} if
		\begin{enumerate}
			\item there exists a message mapping profile $(s_1,\ldots,s_n)$ such that $s_i(\theta_i)$ maximizes the ex-interim utility of agent $i$, that is,
			\[ \E_{-\theta_i} \left[ u_i(g(s_i(\theta_i),s_{-i}(\theta_{-i})),\theta_i) | \theta_i \right] \ge \E_{\theta_{-i}} \left[ u_i(g(m_i',s_{-i}(\theta_{-i})),\theta_i) | \theta_i \right] \]
			for all $m_i',\theta_i,i\in N$, and
			\item $g(s_i(\theta_i),s_{-i}(\theta_{-i})) = f(\theta_i,\theta_{-i})$ for all $i \in N$.
		\end{enumerate}	
		We say that $f$ is Bayesian implementable via $\langle M_1,\ldots,M_n,g\rangle$ under the prior $P$.
	\end{fdef}

	\begin{fprop}
		If an SCF $f$ is dominant strategy implementable, it is Bayesian implementable.
	\end{fprop}

	Similar to \hyperref[def: dsic]{dominant strategy incentive compatibility}, we have the following.

	\begin{fdef}[Bayesian incentive compatibility]
		\label{def: bic}
		A direct mechanism $\langle \Theta_1,\ldots,\Theta_n,f\rangle$ is \emph{Bayesian incentive compatible} (BIC) if
		\begin{equation}
			\label{eqn: dsic}
			\E_{\theta_{-i}} \left[ u_i(f(\theta_i,\theta_{-i}),\theta_i) | \theta_i \right] \ge \E_{\theta_{-i}} \left[ u_i(f(\theta_i',\theta_{-i}),\theta_i) | \theta_i \right].
		\end{equation}
		for all $\theta_i,\theta_i',i$.
	\end{fdef}

	\begin{ftheo}[Revelation principle II]
		If an SCF $f$ is implementable in Bayesian equilibrium, it is BIC.
	\end{ftheo}

	The proof is near-identical to that of the first revelation principle.

\subsection{Arrow's Impossibility Theorem}

	Consider the setting where we have finite sets $A = \{a_1,\ldots,a_m\}$ of alternatives and $N = \{1,\ldots,n\}$ of players. Each player has a preference order $R_i$ over $a$ (a binary relation over $A$) such that
	\begin{enumerate}
		\item Completeness: for every $a,b \in A$, $a R_i b$ or $b R_i a$ or both,
		\item Reflexivity: for all $a \in A$, $a R_i a$, and
		\item Transitivity: for $a,b,c \in A$, if $a R_i b$ and $b R_i c$, then $a R_i c$
	\end{enumerate}
	The set of all such preference orders is denote $\mathcal{R}$. An ordering is linear if for $a,b \in A$, if $aR_i b$ and $bR_i a$, then $a = b$. The set of all such linear orderings is denoted $\mathcal{P}$.\\

	Given any ordering $R_i$, we can decompose it into an \emph{asymmetric part} $P_i$ and \emph{symmetric part} $I_i$.

	\begin{fdef}[Arrovian Social Welfare Function]
		An Arrovian Social Welfare Function (ASWF) is a function $F : \mathcal{R}^n \to \mathcal{R}$.
	\end{fdef}
	That is, given the preference orders of multiple people, we try to consolidate them into a single preference order.\\
	Let $\hat{F}(R)$ and $\overline{F}(R)$ be the asymmetric and symmetric parts of $F(R)$ respectively.

	\begin{fdef}[Pareto]
		An ASWF $F$ is said to be \emph{weak Pareto} if for $a,b \in A$, if $a P_i b$ for all $i \in N$, then $a \hat{F}(R) b$.\\
		An ASWF $F$ is said to be \emph{strong Pareto} if for $a,b \in A$, if $a R_i b$ for all $i \in N$ and for some $j$, $a P_j b$, then $a \hat{F}(R) b$.
	\end{fdef}

	It is not too difficult to see that strong Pareto ASWFs are weak Pareto.\\
	We say that $R_i,R_i'\in\mathcal{R}$ \emph{agree} on $\{a,b\}$ if for agent $i$, $a P_i b$ iff $a P_i' b$, $b P_i a$ iff $b P_i' a$, and $a I_i b$ iff $b I_i a$. We use the shorthand $\restr{R_i}{a,b} = \restr{R_i'}{a,b}$ to denote this. If it holds for every agent $i$, we write $\restr{R}{a,b} = \restr{R'}{a,b}$.

	\begin{fdef}[Independence of irrelevant alternatives]
		An ASWF $F$ is said to satisfy \emph{independence of irrelevant alternatives} (IIA) if for all $a,b \in A$, if $\restr{R}{a,b} = \restr{R'}{a,b}$, then $\restr{F(R)}{a,b} = \restr{F(R')}{a,b}$.
	\end{fdef}
	That is, if everyone prefers one option to another, then the final preference order also prefers this option to the other.\\
	Note that the dictatorship ASWF, defined by $F(R) = R_i$ for some fixed $i$, is both weak Pareto and IIA.

	\begin{ftheo}[Arrow]
		\label{arrow}
		For $|A| \ge 3$, if an ASWF $F$ is weak Pareto and IIA, then it is a dictator.
	\end{ftheo}

	Over the rest of this section, we prove the above.\\
	First, we need some notions of ``decisiveness''.

	\begin{fdef}
		Let $F : \mathcal{R}^n \to \mathcal{R}$ be given, and let $G \subseteq N$ be non-empty.\\
		$G$ is said to be \emph{almost decisive} over $\{a,b\}$, denoted $\overline{D}_G(a,b)$, if if $a P_i b$ for all $i \in G$ and $b P_j a$ for all $j \not\in G$, then $a \hat{F}(R) b$. \\
		$G$ is \emph{decisive} over $\{a,b\}$, denoted $D_G(a,b)$, if if $a P_i b$ for all $i \in G$, then $a \hat{F}(R) b$.
	\end{fdef}
	If a group is (almost) decisive over all pairs of coordinates, we say that it is (almost) decisive.
	% Clearly, any decisive set is almost-decisive. Also note that 

	The proof goes in two parts.
	\begin{enumerate}
		\item Field expansion: If a group is almost decisive over a pair of alternatives, then it is decisive over all pairs of alternatives.
		\item Group contraction: If a group is decisive, a strict subset of that group is also decisive.
	\end{enumerate}

	\begin{lemma}[Field expansion]
		\label{lem: arrow field expansion}
		Let $F$ be WP and IIA. For all $a \ne b$ and $x \ne y$, and $G \subseteq N, G \ne \emptyset$,
		$\overline{D}_G(a,b)$ implies $D_G(x,y)$.
	\end{lemma}
	% That is, both notions of decisiveness are identical
	\begin{proof}
		There are $6$ cases to consider.
		\begin{enumerate}
			\item Case 1. $x = a$ and $y \ne a,b$. Pick arbitrary $R \in \mathcal{R}^n$ such that $a P_i y$ for all $i \in G$. We wish to show that $a \hat{F}(R) y$.\\
			Construct another preference $R'$ as follows. For $i \in G$, we have $a P'_i b$ and $b P'_i y$, and on $N \setminus G$, $b P'_i a$ and $b P'_i y$, and between $a,y$ we retain the same ordering as in $R_i$.\\
			We ensure that $\restr{R_i'}{a,y} = \restr{R_i}{a,y}$ for all $i \in N$. Almost-decisiveness of $F$ over $\{a,b\}$ for $R'$ implies that $a \hat{F}(R') b$. Weak Pareto over $b,y$ implies that $b \hat{F}(R') y$. So, by transitivity, $a \hat{F}(R') y$. Now, use IIA to conclude that $a \hat{F}(R) y$ as well, completing the proof.
			\item Case 2. $y = b$ and $x \ne a,b$. The idea for this is nearly identical to that in case 1. $R'$ is constructed such that for $i \in G$, $x P_i' a$ and $a P_i' b$, and on $N \setminus G$, $x P_i' a$ and $b P_i' a$, and the ordering of $a,b$ is the same as that in $R$.
			\item Case 3. $x \ne a,b$ and $y \ne a,b$. We have $\overline{D}_G(a,b)$, so $D_G(a,y)$ by case 1, so $\overline{D}_G(a,y)$ by definition, so $D_G(x,y)$ by case 2.
			\item Case 4. $x \ne a,b$ and $y = a$. We have $\overline{D}_G(a,b)$, so $D_G(x,b)$ by case 2, so $\overline{D}_G(x,b)$ by definition, so $D_G(x,a)$ by case 1.
			\item Case 5. $x = b$ and $y \ne a,b$. We have $\overline{D}_G(a,b)$, so $D_G(a,y)$ by case 1, so $\overline{D}_G(a,y)$ by definition, so $D_G(b,y)$ by case 2.
			\item Case 6. $x = a$ and $y = b$. This similarly follows from previous parts.
			\item Case 7. $x = b$ and $y = a$. This similarly follows from previous parts.
		\end{enumerate}
	\end{proof}

	\begin{lemma}[Group contraction]
		\label{lem: arrow group contraction}
		Let $F$ be WP and IIA. Let $G \subseteq N$ with $|G| \ge 2$ be decisive. Then, there exists non-empty $G' \subsetneq G$ which is decisive.
	\end{lemma}
	\begin{proof}
		Arbitrarily choose $G_1 \subsetneq G$ and $G_2 = G \setminus G_1$. Let $a,b,c \in R$. Consider an ASWF $R$ which orders $a P_i b P_i c$ for $i \in G_1$, $c P_i a P_i b$ for $i \in G_2$, and $b P_i c P_i a$ for $i \in N \setminus G$. Because $a P_i b$ for all $i \in G$ and $G$ is decisive, $a \hat{F}(R) b$.
		\begin{enumerate}
			\item Case 1. $a \hat{F}(R) c$. Observe that $a P_i c$ for all $i \in G_1$ and $c P_i a$ for $i \not\in G_1$. Consider all $R'$ where this condition holds. By IIA, $a \hat{F}(R') c$. Therefore, $G_1$ is almost decisive over $\{a,c\}$ and by field expansion, $G_1$ is decisive.
			\item Case 2. $c F(R) a$. Recalling that $a \hat{F}(R) b$, we have $c \hat{F}(R) b$. Observe that $c P_i b$ for all $i \in G_2$ and $b P_i c$ for $i \not\in G_2$. Considering all $R'$ where this condition holds again, we get by IIA that $b \hat{F}(R') c$, so $G_2$ is almost decisive over $\{b,c\}$ and by field expansion, $G_2$ is decisive. \qedhere
		\end{enumerate}
	\end{proof}

	To complete the proof of \nameref{arrow}, note that $N$ is decisive, so by \Cref{lem: arrow group contraction}, there is a singleton decisive set and $F$ is a dictator.

\subsection{Social Choice}

	This means the Arrovian social welfare set up is too demanding. It says that achieving a social ordering in a democratic way is impossible. There are two suggestions to mitigate this:
	\begin{enumerate}
		\item consider a social choice setting, where we output an alternative instead of an ordering.
		\item put restrictions on the agents' preferences.
	\end{enumerate}

	\begin{fdef}
		A \emph{social choice function} is a function $f : \mathcal{P}^n \to A$.
	\end{fdef}
	Note that we assume strict preferences.\\
	Over the next few examples, we shall look at various voting rules.

	\begin{fex}[Voting]
		\phantom{pain}
		\begin{enumerate}
		\item Scoring rule. Let $s = (s_1,\ldots,s_m)$ be some common score vector. Each voter's $k$th preferred alternative is given a score of $s_k$. The scores are summed over all candidates, and the candidate with the highest score wins. There are various specific cases depending on $s$.
		\begin{itemize}
			\item Plurality. $s = (1,0,0,\ldots,0)$.
			\item Veto. $s = (1,1,\ldots,1,0)$.
			\item Bonds. $s = (m-1,m-2,\ldots,1,0)$.
			\item Harmonic. $s = (1,1/2,\ldots,1/m)$.
			\item $k$-approval. $s = (1,\ldots,1,0,\ldots,0)$ with exactly $k$ $1$s.
		\end{itemize}

		\item Plurality with runoff. This has two phases: in the first, the top $2$ highest scoring candidates are retained and everyone else eliminated, and in the second everyone is asked to vote again. This is practiced in the French presidential election.
		
		\item Maximin. This chooses the candidate with the largest margin of victory wins.

		\item Copeland. Here we view the set of orderings as a collection of votes for pairwise elections, and choose the candidate who wins the most pairwise elections.
		\end{enumerate}
		A \emph{Condorcet} winner is a candidate that beats every other candidate in a pairwise election. It is not guaranteed to exist.\\
		A voting rule that returns a Condorcet winner, if it exists, as the winner, is called \emph{Condorcet consistent}. Clearly, Copeland is Condorcet consistent. It turns out that \emph{no} scoring rule is Condorcet consistent (!), even seemingly logical strategies such as plurality.
	\end{fex}

	\begin{fdef}[Pareto efficiency]
		An alternative $a$ is \emph{Pareto dominated} by $b$ if for all $i \in N$, $b P_i a$.\\
		An SCF $f$ is \emph{Pareto efficient} if for all preference profiles $P$ and $a \in A$, if $a$ is Pareto dominated, then $f(P) \ne a$.
	\end{fdef}

	\begin{fdef}[Unanimity]
		An SCF $f$ is \emph{unanimous} if for a preference profile $P$ with $P_1(1) = P_2(1) = \cdots = P_n(1) = a$ (where $P_i(k)$ is the $k$th preferred alternative of agent $i$), $f(P) = a$.
	\end{fdef}

	\begin{prop}
		Any Pareto efficient SCF is unanimous, and the converse is not true.
	\end{prop}
	Indeed, every alternative other than $a$ is Pareto dominated by it. Further, this containment is strict, as can be seen by considering an SCF which picks a dominated alternative when not all the top alternatives are identical.

	\begin{fdef}[Ontoness]
		An SCF $f$ is \emph{onto} if for all $a \in A$, there exists $P^* \in \mathcal{P}^n$ such that $f(P^*) = a$.
	\end{fdef}

	\begin{prop}
		Any unanimous SCF is onto.
	\end{prop}
	Indeed, $a$ is chosen by any preference profile which has $a$ at the top spot everywhere.

	\begin{fdef}[Manipulability]
		An SCF $f$ is \emph{manipulable} if there exists a profile $P$ and $i \in N$ such that
		\[ f(P_i',P_{-i}) P_i f(P_i,P_{-i}) \]
		for some $P_i'$.
	\end{fdef}
	That is, false reporting can result in a more preferred outcome.\\
	Non-manipulability means that false reporting can only result in a worse outcome.

	\begin{fex}[Manipulability]
		Consider a voting system with three candidates $a,b,c$ (with ties broken in favour of $a > b > c$). \\
		First, suppose we are in the the plurality setting, and the three voters have true preference orders $abc, bac, cba$. If the third voter reports $cba$, then the winner is $a$. If he reports $bca$ on the other hand, the winner is $b$, who is preferred to $a$.\\
		Next, suppose we are in the Copeland setting, and the three voters have true preference orders $abc,bca,cab$. If everyone reports their true preferences, $a$ is the winner. If the second voter instead reports $cba$, then $c$ becomes the Copeland winner. 
	\end{fex}

	\begin{fdef}[Strategyproofness]
		An SCF is said to be \emph{strategy-proof} (SP), \emph{truthful}, or \emph{incentive-compatible} if it is not manipulable by any agent at any profile.
	\end{fdef}

	Let us look at some properties of strategyproof SCFs.

	\begin{fdef}[Dominated set]
		For $a \in A$ and preference $P_i$, the \emph{dominated set} of $a$ at $P_i$ is
		\[ D(a,P_i) = \{ b \in A : a P_i b \}. \]
	\end{fdef}

	\begin{fdef}[Monotonicity]
		An SCF $f$ is \emph{monotone} (MONO) if for any two profiles $P,P'$ with $f(P) = a$ and $D(a,P_i) \subseteq D(a,P_i')$ for all $i \in N$, then $f(P') = a$.
	\end{fdef}
	That is, if the relative position of $a$ weakly improves from $R$ to $R'$, then $a$ remains the winner.

	\begin{flem}
		\label{lem: sp iff mono}
		An SCF is strategyproof if and only if it is monotone.
	\end{flem}
	% Note the proof technique, which we will see again later.
	\begin{proof}
		Let us look at the forward direction first. Let $f$ be SP and $P,P'$ be two profiles with $f(P) = a$ and $D(a,P_i) \subseteq D(a,P_i')$ for all $i \in N$. For $0 \le k \le n$, let $P^{(k)} = (P_1',P_2',\ldots,P_k',P_{k+1},\ldots,P_n)$ -- note that $P^{(0)} = P$ and $P^{(n)} = P'$. We shall show inductively that $f(P^{(k)}) = a$ for each $0 \le k \le n$. The base case $k = 0$ is trivial.\\
		Suppose that $f(P^{(k-1)}) = a$ but $f(P^{(k)}) = b \ne a$ for some $k \ge 1$.
		Now, note that it is not possible that $b P_k a$ or $a P_k' b$ as this would violate strategyproofness. This means that $a P_k b$ and $b P_k' a$, but this contradicts $D(a,P_k) \subseteq D(a,P_k')$, so we have a contradiction and are done.\\

		Let us now look at the backward direction. Suppose instead that for some profile $P$, $i \in N$, and $P_i'$, $f(P_i',P_{-i}) P_i f(P)$. Set $P' = (P_i',P_{-i}), f(P) = a, f(P') = b$, so $b P_i a$. Construct a preference ordering $P_i''$ with $P_i''(1) = b$ and $P_i''(2) = a$, and let $P'' = (P_i'',P_{-i})$.\\
		We clearly have $D(a,P_j) \subseteq D(a,P_j'')$ for all $j \in N$. Monotonicity implies that $f(P'') = f(P) = a$. On the other hand, $D(b,P'_j) \subseteq D(b,P_j'')$ for all $j \in N$, so by monotonicity $f(P'') = f(P') = b$, resulting in a contradiction.
	\end{proof}
	We shall repeatedly see the above proof strategy.

	\begin{flem}
		If an SCF is monotonic and onto, it is Pareto efficient.
	\end{flem}
	\begin{proof}
		Suppose instead that $f$ is monotonic and onto, but not PE -- let $P$ be a preference profile and $a,b \in A$ such that $b P_i a$ for all $i \in N$, but $f(P) = a$.\\
		Using ontoness, let $P'$ be a profile with $f(P') = b$, and construct a profile $P''$ with $P''_i(1) = b$ and $P''_i(2) = a$ for all $i \in N$. Clearly, $D(b,P') \subseteq D(b,P'')$, so $f(P'') = b$. We also have $D(a,P) \subseteq D(a,P'')$, so $f(P'') = a$, yielding a contradiction.
	\end{proof}

	\begin{fcor}
		Let $f$ be a strategyproof SCF. The following are equivalent.
		\begin{enumerate}
			\item $f$ is Pareto efficient.
			\item $f$ is unanimous.
			\item $f$ is onto.
		\end{enumerate}
	\end{fcor}

	It turns out that even the above requirement is too strict, however.

	\begin{ftheo}[Gibbard-Satterthwaite Theorem]
		\label{theo: GS}
		% G73 S75
		Suppose $|A| \ge 3$. $f$ is strategyproof and onto if and only if it is dictatorial.
	\end{ftheo}
	The above is untrue when $|A| = 2$ -- plurality with some fixed tie-breaking rule is strategyproof, onto, and non-dictatorial. It may also break down if we place restrictions on the set of alternatives that a voter can report (we assume it to be $\mathcal{P}$).\\
	As long as all ordinal ranks are feasible in the cardinal preference setting, this has an extension to that setting.
	% In general, the result does not hold. We use some specific constructions. If possible, the result holds.

	% The remainder of this section is dedicated to the proof of the Gibbard-Satterthwaite Theorem.\\
	We shall only prove the result for $n = 2$ (so $N = \{1,2\}$). It is possible to then apply induction on the number of agents to prove it for an arbitrary $n$, but we omit this part -- interested readers may consult \cite{gs-theo-sen} for more details.

	\begin{proof}
		First of all, we claim that for every preference profile $P$, $f(P) \in \{P_1(1),P_2(1)\}$.\\
		If $P_1(1) = P_2(1)$, unanimity implies that $f(P)$ is this common value.\\
		Suppose that $P_1(1) = a \ne b = P_2(1)$, and $f(P) = c \ne a,b$. Consider a preference $P_1'$ with $P_1'(1) = a, P_1'(2) = b$, and a preference $P_2'$ with $P_2'(1) = b, P_2'(2) = a$. Note that $f(P_1,P_2') \in \{a,b\}$, because every other alternative is Pareto dominated and $f$ is Pareto efficient. Further, $f(P_1,P_2') \ne b$ because this would mean that $f$ is manipulable (by player $2$). Therefore, $f(P_1,P_2') = a$.  Similarly, we get that $f(P_1',P_2) = b$. Now, due to monotonicity (because $f$ is strategyproof), $D(a,P_1) \subseteq D(a,P_1')$, so $f(P_1',P_2') = a$, but similarly $D(b,P_2) \subseteq D(b,P_2')$ so $f(P_1,P_2') = b$, leading to a contradiction and proving the claim.\\

		Now, let $P,P'$ be two profiles with $P_1(1) = a \ne b = P_2(1)$ and $P_1'(1) = c, P_2'(1) = d$. It suffices to show that $f(P') = c$ if $f(P) = a$ and $f(P') = d$ if $f(P) = b$.\\
		If $c = d$, this is trivial by unanimity, so assume $c \ne d$. We shall show that if $f(P) = a$, $f(P') = c$; the other side follows symmetrically.
		
		\begin{enumerate}
			\item First, consider the case where $(c,d) = (a,b)$. By the claim, $f(P') \in \{a,b\}$. Suppose instead that $f(P') = b$. Let profile $\hat{P}$ with $\hat{P}_1(1) = a, \hat{P}_1(2) = b, \hat{P}_2(1) = b, \hat{P}_2(2) = a$.\\
			By monotonicity using $P$, we get that $f(\hat{P}) = f(P) = a$, and by monotonicity using $P'$, we get that $f(\hat{P}) = f(P') = b$, a contradiction.

			\item Next, consider the case where $d = b$ but $c \ne a,b$. Again, we have that $f(P') \in \{c,b\}$, and suppose instead that $f(P') = b$. Let $\hat{P}_1$ be a preference order with $\hat{P}_1(1) = c, \hat{P}_1(2) = a$. By case $1$, $f(\hat{P}_1,P_2) = f(P_1',P_2') = b$. Under true preferences $(\hat{P}_1,P_2)$, we see that player $1$ misreporting their preference as $P_1$ would result in a more preferred alternative ($a$ as opposed to $b$), contradicting strategyproofness.

			\item Next, suppose that $c \ne a,b$ and $d \ne b$, and assume that $f(P') = d$. Let $\hat{P}$ be a profile such that $\hat{P}_1(1) = c, \hat{P}_2(1) = b$. By a symmetric version of case 2 applied for $P',\hat{P}$, $f(\hat{P}) = b$. By case 2 applied for $P,\hat{P}$, $f(\hat{P}) = c$, leading to a contradiction.
		\end{enumerate}
		All remaining cases follow similar to case 3 using previously shown cases, so we omit the details.
	\end{proof}

	A reason for a restrictive result like the GS theorem is that the domain of the SCF is too large, so a potential manipulator has far too many ways to manipulate.\\
	What this means is that we must restrict the domain of our SCF.

\subsection{Domain restriction}

	Consider the following different definition of strategyproofness.\\
	An SCF $f$ is strategyproof if for all $i \in \N, P_i,P_i' \in \mathcal{P}, P_{-i} \in \mathcal{P}^{n-1}$,
	\[ f(P_i,P_{-i}) P_i f(P_i',P_{-i}) \text{ or } f(P_i,P_{-i}) = f(P_i',P_{-i}). \]
	If we reduce the set of preferences from $\mathcal{P}$ to $\mathcal{S} \subsetneq \mathcal{P}$, a function that is strategyproof on $\mathcal{P}$ continues to remain strategyproof on $\mathcal{S}$. However, we may get some more strategyproof functions.\\

	There are various examples of domain restrictions which lead to interesting non-dictatorial strategyproof SCFs.

	\subsubsection{Single-peaked preferences}
		Consider the example of a room with several people in it, and each person has a preferred temperature $t_i^*$ -- anything above or below this is monotonically disliked more. The agent preferences are ``single-peaked'' in the sense that there is one unique temperature we like the most, and everything else is liked less in a monotonic fashion.\\
		There is a common ordering, the temperature scale here, and each person has a unique preferred point, and on each side there is a monotone decrease. % the two decreases may be different.

		This common ordering is denoted $<$, where the order is any total order (a binary relation is transitive and antisymmetric).

		Why is this a domain restriction? If the ordering is over $\{a,b,c\}$ and the ordering is $a<b<c$, then preferences such as $acb$ are ruled out.

		\begin{fdef}[Single-peaked preference]
			A preference order $P_i$ (that is linear over $A$) of agent $i$ is \emph{single-peaked} with respect to the common order $<$ of the alternatives $A$ if
			\begin{enumerate}
				\item for all $b,c \in A$ with $b < c \le P_i(1)$, $c P_i b$ and
				\item for all $b,c \in A$ with $P_i(1) \le b < c$, $b P_i c$.
			\end{enumerate}
			Denote by $\mathcal{S}$ the set of single-peaked preferences.
		\end{fdef}

		So, under this domain restriction, our SCF is a function $\mathcal{S}^n \to A$.\\
		We also typically take $A$ to be a finite subset of $\R$.\\
		This circumvents the Gibbards-Satterthwaite Theorem as seen by the strategyproof, onto, and non-dictatorial SCF which just outputs the leftmost peak. Clearly, the player with the leftmost peak has no reason to misreport. For any other player, misreporting only changes the outcome if they report something less than the leftmost peak, and they necessarily prefer this less than the current outcome.\\
		A generalization of this is as follows.

		\begin{fdef}[Median voter SCF]
			An SCF $f : \mathcal{S}^n \to A$ is a \emph{median voter SCF} if there exists a multiset $B = \{y_1,\ldots,y_{n-1}\}$ such that $f(P) = \operatorname{median}(B,\operatorname{peaks}(P))$ for all $P \in \mathcal{S}$.
		\end{fdef}

		The points in $B$ are called the peaks of ``phantom voters''. Note that $B$ is fixed for $f$ and does not change with $P$.

		\begin{flem}[Moulin 1980]
			\label{lem: median stratproof}
			Every median voter SCF is strategyproof.
		\end{flem}

		We do not prove this as it is relatively simple -- the proof is similar to what we did when considering the leftmost peak SCF.

		\begin{fprop}
			\label{prop: singlepeaked pareto efficient characterization}
			$f$ is Pareto efficient iff for each preference $P$, setting $p_{\min},p_{\max}$ be the leftmost and rightmost peaks, $f(P) \in [p_{\min},p_{\max}]$.
		\end{fprop}

		\begin{proof}
			First, suppose that $f(P) \not\in [p_{\min},p_{\max}]$. Assume that $f(P) < p_{\min}$ without loss of generality. Then, every agent prefers $p_{\min}$ to $f(P)$, so $f(P)$ is dominated and $f$ is not Pareto efficient.\\
			On the other hand, if $f(P) \in [p_{\min},p_{\max}]$, there does not exist any $b$ such that $b P_i f(P)$ for all $i \in N$. Indeed, if $b < f(P)$, it is less preferred by the player with peak $p_{\max}$, and if $b > f(P)$, it is less preferred by the player with peak $p_{\min}$. This vacuously implies Pareto efficiency.
		\end{proof}

		Although the proofs differ quite a bit, several results like in the unrestricted setting hold even here.

		\begin{ftheo}
			Let $f : \mathcal{S}^n \to A$. If $f$ is strategyproof, it is monotonic.
		\end{ftheo}
		The proof of this is quite similar to that we did earlier in \Cref{lem: sp iff mono}, although we need to argue why the construction in the reverse implication is valid.

		\begin{ftheo}
			\label{theo: single-peaked equivalence}
			Let $f : \mathcal{S}^n \to A$ be strategyproof. The following are equivalent.
			\begin{enumerate}
				\item $f$ is onto.
				\item $f$ is unanimous.
				\item $f$ is Pareto efficient.
			\end{enumerate}
		\end{ftheo}

		\begin{proof}
 			We know that Pareto efficiency implies unanimity which implies ontoness. As a result, it suffices to show that ontoness implies Pareto efficiency. Suppose instead that $f$ is strategyproof and onto but not Pareto efficient. Then, there exist $a,b \in A$ such that $a P_i b$ for all $i \in N$ but $f(P) = b$. Because preferences are single-peaked, there is some alternative $c \in A$ which is a ``neighbour'' of $b$ such that $c P_i b$ for all $i \in N$ (possibly, $c = a$) -- go ``one step'' in the direction of $a$ from $b$.\\
			Using ontoness, let $P'$ such that $f(P') = c$. Consider $P''$ such that $P_i''(1) = c$ and $P_i''(2) = b$ for all $i \in N$. Due to monotonicity from $P$ to $P''$, $f(P'') = b$, and due to monotonicity from $P'$ to $P''$, $f(P'') = c$, leading to a contradiction.
		\end{proof}

		\begin{fdef}
			Given a preference profile $P$ and a permutation $\sigma : N \to N$, define a new preference profile $P^\sigma$ by $(P \circ \sigma^{-1})$ -- the preference of $i$ under $P$ is the preference of $\sigma(i)$ in the new profile.
		\end{fdef}

		\begin{fdef}[Anonymity]
			An SCF $f : \mathcal{S}^n \to A$ is said to be \emph{anonymous} if for every profile $P$ and permutation $\sigma$ of the agents, $f(P^\sigma) = f(P)$.
		\end{fdef}

		Any social choice function that specifically looks at the agent identities is not anonymous. In particular, dictatorial SCFs are not anonymous.\\
		Anonymity seems a sensible property to desire from a good SCF.

		\begin{ftheo}[Moulin 1980]
			An SCF $f$ is strategyproof, onto, and anonymous iff it is a median voter SCF.
		\end{ftheo}
		\begin{proof}
			The backward direction is trivial. We have already seen in \Cref{lem: median stratproof} that $f$ is strategyproof. It is also trivially anonymous because we only look at the set of peaks and do not assign importance to any particular player's peak. For ontoness, given an alternative $a$, we can consider the preference profile that places every player's peak at $a$. Clearly, the outcome is $a$.\\

			Let $f : \mathcal{S}^n \to A$ be strategyproof, anonymous, and onto. Define $P_i^0$ to be agent $i$'s preference with a peak at the leftmost position, and $P_i^1$ as that with a peak at the rightmost position. First, construct the phantom peaks
			\[ y_j = f(P_1^0,P_2^0,\ldots,P_{n-j}^0,P_{n-j+1}^1,\ldots,P_n^1) \]
			for $j = 1,\ldots,n-1$.\\
			
			First, we claim that the $(y_j)$ is non-decreasing.\\
			Note that the profiles we use to define $y_j$ and $y_{j+1}$ differ only at the $(n-j)$th coordinate. Consequently, due to strategyproofness, we must have $y_j P_{n-j}^0 y_{j+1}$ or the two are equal. However, $P_{n-j}^0$ is single-peaked with its peak at the leftmost position, so this just means that $y_j \le y_{j+1}$.\\

			Let $P$ be an arbitrary profile, and $p_i$ be the peaks of $P_i$. We claim that
			\[ f(P) = \operatorname{median}(p_1,\ldots,p_n,y_1,\ldots,y_n). \]
			Due to anonymity, we may assume without loss of generality that $p_1 \le \cdots \le p_n$. Say $a$ is the median we are interested in.\\
			
			First, consider the case where $a = y_j$ for some $j$. By the previous claim and the definition of the median, we must have that $(j-1)$ phantom peaks and $(n-j)$ agent peaks are to the left, and $(n-1-j)$ phantom peaks and $j$ agent peaks to the right of $a$. That is,
			\[ p_1 \le \cdots \le p_{n-j} \le y_j = a \le p_{n-j+1} \le \cdots \le p_n. \]
			By definition,
			\[ y_j = f(P_1^0,P_2^0,\ldots,P_{n-j}^0,P_{n-j+1}^1,\ldots,P_n^1). \]
			Let
			\[ b = f(P_1,,P_2^0,\ldots,P_{n-j}^0,P_{n-j+1}^1,\ldots,P_n^1). \]
			Due to strategyproofness, $y_j P_1^0 b$, so $y_j \le b$. By strategyproofness again, $b P_1 y_j$. Further, $p_1 \le y_j$, so this means that $b \le y_j$. Therefore, $b = y_j$! We can then repeat this argument for the first $(n-j)$ agents to get that
			\[ f(P_1,\ldots,P_{n-j},P_{n-j+1}^1,\ldots,P_n^1) = y_j. \]
			After this, we replace preferences from the right hand-side, to finally get that $y_j = f(P)$.\\

			Next, suppose that $a = p_j$ for some $j$. We prove this in the case where there are two players, and the general case is a (slightly non-trivial) extension of this argument.\\
			Let $a = P_1(1)$ and $b = P_2(1)$. 

			Let $P'$ such that $P_i(1) = P_i'(1)$ for all $i \in N$. We claim that $f(P) = f(P')$. That is, as long as the peaks stay the same, the preferences stay the same.\\
			Set $f(P) = x$ and $f(P_1',P_2) = y$. Because $f$ is strategyproof, $x P_1 y$ and $y P_1' x$. If $x$ and $y$ are on the same side of the peak $a$, then they must be the same.\\
			Assume without loss of generality that $x < a < y$ and $a < b$. Recall that $f$ is Pareto efficient by \Cref{theo: single-peaked equivalence}, so by \Cref{prop: singlepeaked pareto efficient characterization}, $f(P) \in [a,b]$. However, we have $f(P) = x < a$. We repeat this same argument to go from $(P_1',P_2)$ to $(P_1',P_2')$, thus proving the claim.\\
			
			Now, set $y_1$ to be the phantom peak obtained from earlier. By our assumption, the median is an agent peak, so say it is equal to $a$. This means that $b < a < y_1$ or $y_1 < a < b$. Assume for contradiction that $f(P) = c \ne a$.\\
			In the situation where $b < a < y_1$, we have by Pareto efficiency that $c < a$. Construct $P_1'$ such that $P_1'(1) = a$ and $y_1 P_1' c$ (this is possible because $c$ and $y_1$ are on different sides of the peak). Conider the profile $(P_1^1,P_2)$. We have $b < y_1 \le P_1^1(1)$ so the median of the three is $y_1$, a phantom peak, and we can use case 1 to conclude that $f(P_1^1,P_2) = y_1$. However, $y_1 P_1' c$ by construction, contradicting strategyproofness since $f(P_1',P_2) = c$.\\
			The case where $y_1 < a < b$ is very similar, except that we consider $P_1^0$ instead of $P_1^1$.
		\end{proof}

		For a complete proof of the above result (with $n$ players), the reader may consult \cite{moulin-singlepeak}.

	\subsubsection{Task allocation domain}

		The next domain restriction we shall look at is called task allocation domain. In this, we have a unit amount of task to be shared among $n$ agents, and agent $i$ gets a share $s_i \in [0,1]$ such that $\sum_{i \in N} s_i = 1$.\\
		Similar to single-peaked preferences, every agent has a preferred shared of work. 

		\begin{fex}
			Each task may have a reward, say a $w$ amount of wages per unit time. If agent $i$ works for time $t_i$, then they earn an amount of $wt_i$. This task also has costs (say physical tiredness) depending on the agent equal to $c_it_i^2$. The net payoff is then $wt_i - c_it_i^2$, which is maximized at $t_i^* = w/(2c_i)$.\\
			This is single-peaked over the \emph{share of the task}, and not the alternatives. \\
			If the alternatives are $(0.2,0.4,0.4)$ and $(0.2,0.6,0.2)$, player $1$ is indifferent. Note that if the preferences are single-peaked for all, we cannot have a single common order over the alternatives.
		\end{fex}

		Denote the domain of task allocation by $T$ (a single-peaked function over the task share), so the SCF is $f : T^n \to A$. For a preference profile $P \in T^n$, we have $(f(P))_i \in [0,1]$ for each $i$ and $\sum_{i \in N} (f(P))_i = 1$.\\
		Suppose that player $i$ has peak $p_i$ over the share.

		\begin{fdef}
			An SCF $f : T^n \to A$ is \emph{Pareto efficient} if there exists no other share of the task that is weakly preferred by all agents and strictly preferred by at least one. That is, there exists no $a \in A$ such that $a R_i f(P)$ for all $i \in N$ and $a P_j f(P)$ for some $j$.
		\end{fdef}

		\begin{flem}
			\label{lem: task allocation pe}
			An SCF $f : T^n \to A$ is Pareto efficient iff
			\begin{enumerate}
				\item for any preference profile $P$ with $\sum_{i \in N} p_i = 1$, $f_i(P) = p_i$ for all $i \in N$.
				\item for any preference profile $P$ with $\sum_{i \in N} p_i > 1$, $f_i(P) \le p_i$ for all $i \in N$.
				\item for any preference profile $P$ with $\sum_{i \in N} p_i = 1$, $f_i(P) \ge p_i$ for all $i \in N$.
			\end{enumerate}
		\end{flem}
		\begin{proof}
			First of all, if $\sum_{i \in N} p_i = 1$, then there is no problem and we must allocate tasks according to the peaks of the agents. This is the unique Pareto efficient SCF.\\

			If $\sum_{i \in N} p_i > 1$, for any SCF $f$, there exists some $k \in N$ such that $f_k(P) < p_k$.\\
			If $f$ is Pareto efficient, can there exist an agent $j$ such that $f_j(P) > p_j$? No, because if this were the case, we would increase $k$'s share of the task and reduce $j$'s share of the task, to make both players strictly better off.\\
			Consequently, for all $j \in N$, $f_j(P) \le p_j$.

			Finally, an identical argument yields that if $\sum_{i \in N} p_i < 1$, $f_j(P) \ge P_j$ for all $j \in N$.
		\end{proof}


		\begin{fdef}[Anonymity]
			For an anonymous SCF $f : T^n \to A$,
			\[ f_{\sigma(j)}(P^\sigma) = f_j(P). \]
		\end{fdef}
		% Note that along with permuting of the agent shares, we permute the peaks as well!\\

		Let us look at a couple of candidate SCFs.
		\begin{enumerate}
			\item Serial dictatorship. A predetermined sequence of agents is fixed. Each agent is given either their peak or a leftover share. If $\sum p_i < 1$, the last agent is given the leftover share. This is Pareto efficient and strategyproof but not anonymous. It is also quite unfair for later agents.
			\item Proportional. Every player is assigned a share that is some constant multiplied by their peaks. That is, if $\sum_{i \in N} p_i = s$, we assign a share of $p_i/s$ to each player.\\
			This is not strategyproof. For example, if the peaks are $0.2,0.3,0.1$, we have $s = 0.6$ and player $1$ gets $1/3$. If they report $0.1,0.3,0.1$ instead however, player $1$ gets $0.2$.
		\end{enumerate}

		We shall next describe a rule that is Pareto efficient, anonymous, and strategyproof, known as the \emph{uniform rule}.\\
		Suppose that $\sum_{i \in N} p_i < 1$. We begin with everyone's allocation being $1$. We keep reducing each person's allocation uniformly. Whenever we hit someone's peak, we stop reducing that agent's share. We stop reducing when $\sum f_i = 1$.\\
		When $\sum_{i \in N} p_i > 1$, we instead start with everyone's allocation being $0$ and increase it gradually.

		\begin{fdef}
			The uniform allocation rule $f^u$ is described as follows.
			\begin{enumerate}
				\item If $\sum_i p_i = 1$, $f_i^u(P) = p_i$.
				\item If $\sum_{i \in N} p_i < 1$, set $\mu(P)$ as the number that satisfies $\sum_{i \in N} \max\{p_i,\mu\} = 1$ and allocate $f_i^u(P) = \max\{p_i,\mu(P)\}$.
				\item If $\sum_{i \in N} p_i > 1$, set $\lambda(P)$ as the number that satisfies $\sum_{i \in N} \min\{p_i,\lambda\} = 1$ and allocate $f_i^u(P) = \min\{p_i,\lambda(P)\}$.
			\end{enumerate}
		\end{fdef}

		\begin{flem}
			The uniform rule SCF is anonymous, Pareto efficient, and strategyproof.
		\end{flem}
		\begin{proof}
			It is quite easy to see anonymity since we only look at the agents' peaks and not the agents themselves.
			Pareto efficiency follows trivially by \Cref{lem: task allocation pe}.\\
			Strategyproofness is evident when $\sum p_i = 1$.
			Suppose now that $\sum_i p_i < 1$, so $f_i^u(P) \ge p_i$. The only agents who have any reason to manipulate are those with $f_i^u(P) > p_i$. That is, $\mu(P) > p_i$ and the allocation stopped before ``reaching'' $p_i$. The only way this allocation can change is by reporting $p_i' > \mu(P) > p_i$, but this is a worse allocation for $i$ than $\mu(P)$. The proof when $\sum p_i > 1$ is similar.
		\end{proof}

		\begin{ftheo}[Sprumont]
			An SCF $f : T^n \to A$ is strategyproof, Pareto efficient, and anonymous iff it is the uniform rule.
		\end{ftheo}
		We do not describe the proof of the above, and refer the reader to \cite{sprumont-uniform-rule}.

	\subsubsection{Mechanism design with transfers}
		\label{sec: mechanism design w transfers}

		In this case, the utility can be transferred and is thought of as something like money. A social choice function here is a function $F : \Theta \to X$, where an outcome $x \in X$ has two components -- an allocation $a \in A$ and a payment vector $\pi \in \R^n$.

		\begin{fex}
			\label{ex: payment irl examples}
			One real-life example of this is a public decision of building a bridge or a park, so $A$ is $\{\text{bridge},\text{park}\}$.\\
			We can think of the allocation of a divisible good (a ``shared spectrum''), where $a \in [0,1]^n$ and $\sum a_i = 1$.\\
			We can also have a single indivisible good, where $a \in \{0,1\}^n$ and $\sum a_i \le 1$.\\
			Alternatively, we can have multiple indivisible objects, wherein we have an overall set of objects $S$ and
			\[ A = \{ (A_1,\ldots,A_n) : A_i \subseteq S\text{ and }A_i \cap A_j = \emptyset \text{ for all distinct $i,j \in N$} \}. \]
		\end{fex}

		Here, the type of an agent is $\theta_i \in \Theta_i$, the private information of $i$. An agent's benefit from an allocation is defined using a \emph{valuation function} $v_i : A \times \Theta_i \to \R$.\\
		In the previous example, if we look at the benefit to the environment for example, the valuation of a bridge would be lower than that for a park.\\

		The utility of a player $i$ when their type is $\theta_i$ and the outcome is $x = (a,\pi)$ is given by
		\[ u_i( (a,\pi) , \theta_i ) = v_i(a,\theta_i) - \pi_i. \]
		Note that this is always linear in the payment, but can be non-linear in the allocation component. Due to this, we call this the \emph{quasilinear domain}. \\
		If we have two alternatives $(a,\pi^{(1)})$ and $(a,\pi^{(2)})$, agent $i$ always prefers that with the lower $\pi_i$! This is the simple restriction intrinsic to this section, which opens up opportunity for numerous interesting SCFs.\\

		We split the function $F$ into the allocation part and the payment parts, $f : \Theta \to A$ and $p_i : \Theta \to \R$. Here, $\pi_i = p_i(\theta)$. The tuple of $p_i$ is denoted $p$.

		\begin{fex}[Allocation rules]
			\label{ex: payment alloc rules}
			A couple of examples of allocation rules are as follows.
			\begin{enumerate}
				\item One uninteresting allocation rule is the \emph{constant rule} where $f^c(\theta) = a$ for all $\theta \in \Theta$ for some fixed $a \in A$.

				\item A slightly more inspired rule is the \emph{dictatorial rule}, where
				\[ f^D(\theta) = \argmax_{a \in A} v_d(a,\theta_d) \]
				for all $\theta \in \Theta$ for some fixed $d \in N$.
				
				\item The \emph{allocatively efficient} or \emph{utilitarian} rule is
				\[ f^{\text{AE}}(\theta) = \argmax_{a \in A} \sum_{i \in N} v_i(a,\theta_i) \]
				for all $\theta \in \Theta$, where we pick any arbitrary $a$ in the maximizing subset of $A$.
				% Allocative efficiency is \emph{not} the same as Pareto efficiency, which is defined for the outcome which also considers the payment.

				\item The \emph{affine maximizer} rule is defined by
				\[ f^{\text{AM}}(\theta) = \argmax_{a \in A} \left( \sum_{i \in N} w_i v_i(a,\theta_i) + \kappa(a) \right), \]
				where each $\lambda_i$ is chosen to be non-negative and at least one is nonzero. Note that all three rules before this are specific cases of the affine maximizer rule.

				\item The \emph{max-min} or \emph{egalitarian rule} has
				\[ f^\text{MM}(\theta) = \argmax_{a \in A} \min_{i \in N} v_i(a,\theta_i). \]
			\end{enumerate}
		\end{fex}

		\begin{fex}[Payment rules]
			\label{ex: payment rules}
			Three examples of rules that our payment function $p$ might satisfy are
			\begin{enumerate}
				\item \emph{No deficit}. Here, $\sum_{i \in N} p_i(\theta) \ge 0$ for all $\theta \in \Theta$.
				\item \emph{No subsidy}. Here, $p_i(\theta) \ge 0$ for all $\theta \in \Theta, i \in N$. Clearly, a no subsidy payment rule is a no deficit payment rule.
				\item \emph{Budget balanced}. Here, $\sum_i p_i(\theta) = 0$ for all $\theta \in \Theta$. 
			\end{enumerate}
		\end{fex}

		Recall \hyperref[def: dsic]{incentive compatibility}. This definition can be reformulated in the mechanism design with payment scenario as follows.

		\begin{fdef}[Dominant strategy incentive compatibility]
			\label{def: payment dsic}
			A mechanism $(f,p)$ is \emph{dominant strategy incentive compatible} (DSIC) if for all $i \in N, \theta_{-i} \in \Theta_{-i}, \theta_i,\widetilde{\theta}_i \in \Theta_i$, if we set $\theta = (\theta_i,\theta_{-i})$ and $\widetilde{\theta} = (\widetilde{\theta}_i,\theta_{-i})$,
			\[ v_i(f(\theta),\theta_i) - p_i(\theta) \ge v_i(f(\widetilde{\theta}),\theta_i) - p_i(\widetilde{\theta}). \]
		\end{fdef}

		DSIC means that telling the truth is a weakly dominating strategy equilibrium.

		Our goal is that the payment rule implements $f$ in dominant strategies. In the quasilinear domain, we are often more interested in the allocation rule than the whole SCF (which also includes the payment).
		
		\begin{fex}
			Suppose that there are two players $N = \{1,2\}$ and $\Theta_1 = \Theta_2 = \{\theta^H, \theta^L\}$ and $f : \Theta_1 \times \Theta_2 \to A$. For $(f,p)$ to be DSIC,
			\begin{align*}
				v_1( f(\theta^H, \theta_2) , \theta^H ) - p(\theta^H,\theta_2) &\ge v_1(f(\theta^L,\theta_2) , \theta^H) - p_i(\theta^L,\theta_2) \\
				v_1( f(\theta^L, \theta_2) , \theta^L ) - p(\theta^L,\theta_2) &\ge v_1(f(\theta^H,\theta_2) , \theta^L) - p_i(\theta^H,\theta_2)
			\end{align*}
			and similar inequalities for the second player. 
		\end{fex}

		Now, suppose that $(f,p)$ is incentive compatible. Consider another payment
		\[ q_i(\theta) = p_i(\theta) + h_i(\theta_{-i}) \]
		for all $\theta \in \Theta,i \in N$ for some function(s) $h_i$. Then, observe that $(f,q)$ is incentive compatible as well!\\
		Therefore, if we find a single payment that implements an allocation rule, we get an entire family of payments that implement the allocation rule. A converse question we can ask is: when do payments that implement $f$ differ only by a factor of $h_i(\theta_{-i})$?

		\begin{fex}
			Suppose the allocation is the same for two type profiles $\theta = (\theta_i,\theta_{-i})$ and $\widetilde{\theta} = (\widetilde{\theta_i},\theta_{-i})$ and $f(\theta) = f(\widetilde{\theta}) = a$. if $p$ implements $f$, then \Cref{def: payment dsic} immediately yields that $p_i(\theta) = p_i(\widetilde{\theta})$.
		\end{fex}

		Let us now move to Pareto efficiency in the quasilinear domain.

		\begin{fdef}[Pareto optimality]
			A mechanism $(f,p)$ is said to be \emph{Pareto optimal} if at every type profile $\theta \in \Theta$, there exists no allocation $b \ne f(\theta)$ and payments $(\pi_1,\ldots,\pi_n)$ with $\sum_i \pi_i \ge \sum_i p_i(\theta)$ such that
			\[ v_i(b,\theta_i) - \pi_i \ge v_i(f(\theta),\theta_i) - p_i(\theta) \]
			for all $i \in N$, with the inequality being strict for some $i$.
		\end{fdef}

		The reason for having $\sum_i \pi_i \ge \sum_i p_i(\theta)$ is that otherwise, we can always put an excessive subsidy to every agent and make everyone better off.\\
		Recall allocative efficiency from \Cref{ex: payment alloc rules}.

		\begin{ftheo}
			A mechanism $(f,p)$ is Pareto optimal if and only if it is allocatively efficient.
		\end{ftheo}
		\begin{proof}
			\phantom{pain}
			\begin{itemize}
				\item Suppose that $(f,p)$ is not allocatively efficient. Then, there exists $b \ne f(\theta)$ such that
				\[ \sum_i v_i(b,\theta_i) > \sum_{i \in N} v_i(f(\theta),\theta_i) \]
				for some $\theta$. Let $\delta > 0$ be the difference between the two as above. Consider the payment
				\[ \pi_i = v_i(b,\theta_i) - v_i(f(\theta),\theta_i) + p_i(\theta) - (\delta/n). \]
				Then,
				\[ \left( v_i(b,\theta_i) - \pi_i \right) - \left(v_i(f(\theta),\theta_i) - p_i(\theta)\right) = (\delta/n) > 0 \]
				and $\sum_i \pi_i = \sum_i p_i(\theta)$, showing that $(f,p)$ is not Pareto optimal.

				\item Suppose that $(f,p)$ is not Pareto optimal. Let $\theta,\pi,b \ne f(\theta)$ such that
				\[ \sum_i \pi_i \ge \sum_i p_i(\theta) \]
				and
				\[ v_i(b,\theta_i) - \pi_i \ge v_i(f(\theta),\theta_i) - p_i(\theta) \]
				for all $i \in N$, with the inequality being strict for some $i$.\\
				Summing the second inequality over $i$,
				\begin{align*}
					\sum_i (v_i(b,\theta_i) - \pi_i) &> \sum_i (v_i(f(\theta),\theta_i) - p_i(\theta)) \\
					\sum_i v_i(b,\theta_i) - \sum_i v_i(f(\theta),\theta_i) &> \sum_i \pi_i - \sum_i p_i(\theta) \ge 0,  
				\end{align*}
				showing that $(f,p)$ is not allocatively efficient.
			\end{itemize}
		\end{proof}

		So, for any Pareto optimal mechanism $(f^\eff,p)$, we have
		\[ f^\eff(\theta) \in \argmax_{a \in A} \sum_{i \in N} v_i(a,\theta_i). \]
		This seems to suggest that any sensible mechanism has this (more or less) fixed allocation part. We must now come up with a sensible payment part to make it DSIC.
		
		\begin{fdef}[Groves payment]
			Given a Pareto optimal function $f^\eff$, consider the \emph{Groves payment} defined for each $i$ by
			\[ p_i^G(\theta) = h_i(\theta_{-i}) - \sum_{j \ne i} v_j(f^\eff(\theta),\theta_j) \]
			where $h_i : \Theta_{-i} \to \R$ is any arbitrary function.\\
			A \emph{Groves mechanism} is a pair $(f^\eff,p^G)$, where $f^\eff$ is Pareto optimal and $p^G$ is a Groves payment (for $f^\eff$).
		\end{fdef}

		Perhaps surprisingly, this is a truthful mechanism!

		\begin{ftheo}
			Any Groves mechanism is DSIC.
		\end{ftheo}
		\begin{proof}
			Arbitrarily choose player $i$, $\theta = (\theta_i,\theta_{-i})$, and $\widetilde{\theta} = (\widetilde{\theta}_i,\theta_{-i})$, and set $a = f^\eff(\theta)$ and $\widetilde{a} = f^\eff(\widetilde{\theta})$. By definition,
			\[ v_i(a,\theta_i) + \sum_{j \ne i} v_j(a,\theta_j) \ge v_i(\widetilde{a},\theta_i) + \sum_{j \ne i} v_j(\widetilde{a},\theta_j). \]
			The utility of player $i$ when they report $\theta_i$ is
			\begin{align*}
				v_i(a,\theta_i) - p_i(\theta) &= v_i(a,\theta_i) - h_i(\theta_{-i}) + \sum_{j \ne i} v_j(a,\theta_j) \\
				&\ge v_i(\widetilde{a},\theta_i) - h_i(\theta_{-i}) + \sum_{j \ne i} v_j(\widetilde{a},\theta_j) \\
				&= v_i(\widetilde{a},\theta_i) - p_i(\widetilde{\theta}),
			\end{align*}
			proving the result.
		\end{proof}

		\begin{fdef}[VCG mechanism]
			Given a Pareto optimal function $f^\eff$, the \emph{pivotal mechanism} or \emph{VCG mechanism} is the Groves mechanism $(f^\eff,p^\VCG)$ with
			\[ h_i(\theta_{-i}) = \max_{a \in A} \sum_{j \ne i} v_j(a,\theta_j). \]
			That is,
			\[ p_i^\VCG(\theta) = \max_{a \in A} \sum_{j \ne i} (v_j(a,\theta_j) - v_j(f^\eff(\theta),\theta_j)). \]
		\end{fdef}

		Clearly, $p_i^\VCG(\theta) \ge 0$ for all $\theta \in \Theta,i \in N$, that is, it is a no subsidy payment rule (and in particular, a no deficit payment rule). The first part is essentially the values of others in the absence of agent $i$. When agent $i$ is introduced, the others get less than they could have in $i$'s absence, and the expression above can be thought of as the ``damages'' caused by agent $i$ which are compensated for by this payment. In other words,
		\[ v_i(f^\eff(\theta),\theta_i) - p_i^\VCG(\theta) = \underbrace{\sum_{j \in N} v_j(f^\eff(\theta),\theta_j)}_{\text{social welfare in presence of $i$}} - \underbrace{\max_{a \in A} \sum_{j \ne i} v_j(a,\theta_j)}_{\text{maximum social welfare in absence of $i$}}, \]
		is the marginal contribution of $i$ to social welfare.\\
		Let us try to understand this better with a couple of examples.

		\begin{fex}
			\label{vcg obj allocation}
			Consider single object allocation where an agent's type $\theta_j$ is equal to the amount they value the object, and the value is equal to $\theta_j$ if they get the item and $0$ otherwise. Suppose that there are $4$ agents with valuations $10,8,9,5$. Allocative efficiency means that the item is allocated to that agent with the highest valuation, namely $10$. We have
			\[ p_i^\VCG(\theta) = \max_{a \in A} \sum_{j \ne i} (v_j(a,\theta_j) - v_j(f^\eff(\theta),\theta_j)). \]
			For the agent with valuation $10$, this is equal to the second highest bid $9$. Indeed, the first summation is maximized when $a$ assigns the item to the agent with the second highest bid $9$, and the second summation is equal to $0$. For all other agents, both summations are equal to the higest bid $10$.\\
			Therefore, under the VCG mechanism, the only agent who pays is the first agent, and he pays the second highest bid $9$. This makes sense since the utility of agent $i$ is equal to $10-9 = 1$, which is the amount they ``profit'' by paying less than the amount they value the item.\\
			The VCG mechanism for single object allocation behaves is precisely a \hyperref[ex: second price auction]{second price auction}!

			Let us look at another example, wherein a committee must decide to build one of a football stadium, a library, or a museum. The members of the committee $A,B,C$ value each of these as follows.
			\begin{center}
			\begin{tabular}{|c||c|c|c|}
				\hline
				& \text{Football} & \text{Library} & \text{Museum} \\
				\hline\hline
				A & $0$ & $70$ & $50$ \\
				\hline
				B & $95$ & $10$ & $50$ \\
				\hline
				C & $10$ & $50$ & $50$ \\ \hline
			\end{tabular}
			\end{center}
			Due to allocative efficiency, the VCG mechanism decides to build the museum. If $B$ is removed, it is instead decided to build the library which has corresponding value $70+50 = 120$. So, $B$ pays an amount of $120-100 = 20$. Similarly, $A$ pays $(95+10)-100 = 5$, and $C$ pays $(50+50)-100 = 0$.\\
			Note that agent $C$ pays nothing! They can be thought of as a \emph{non-pivotal} agent, and removing the player does not change the outcome of the game.
		\end{fex}

		Agents whose presence changes the outcome are referred to as \emph{pivotal agents}. These are precisely those players who have to pay some nonzero amount of money.\\
		Over the next several examples, we more precisely look at combinatorial auctions from \Cref{ex: payment irl examples}.

		\begin{fex}[Combinatorial auctions I: An example]
			Let us look at another example of selling multiple objects $1$ and $2$.
			\begin{center}
			\begin{tabular}{|c||c|c|c|c|}
				\hline
				& $\emptyset$ & $\{1\}$ & $\{2\}$ & $\{1,2\}$ \\
				\hline\hline
				$\theta_1$ & $0$ & $8$ & $6$ & $12$ \\
				\hline
				$\theta_2$ & $0$ & $9$ & $4$ & $14$ \\ \hline
			\end{tabular}
			\end{center}
			The above table indicates each player value $v_i(a,\theta_i) \eqqcolon \theta_i(a)$ under various actions. Note that the meaning of the table here is not as directly interpreted as that in the previous example -- an allocation is a pair of non-intersecting subsets of $\{1,2\}$. That is, we can decide to allocate $\{1\}$ to one agent and $\{2\}$ to another (but we cannot allocate item $1$ to both agents). \\
			In fact, this is what happens. Due to allocative efficiency, the VCG mechanism allocates $\{1\}$ to player $2$ and $\{2\}$ to player $1$. If player $1$ is removed, we give the entire bundle to player $2$ for value $14$, so player $1$ pays $14-9 = 5$ and similarly, player $2$ pays $12-6 = 6$. The payoffs of the two players here are $6-5 = 1$ and $9-6 = 3$.
		\end{fex}


		\begin{fex}[Combinatorial auctions II: Introduction]
			In a \emph{combinatorial auction}, there is a fixed set $M$ of objects, and $\Omega = 2^M$ is set of ``bundles''. The set of allocations $A$ is comprised of all elements $a = (a_0,a_1,\ldots,a_n)$ of $\Omega^n$ such that $a_i \cap a_j = \emptyset$ for $i \ne j$ and $M = \bigcup_{i=0}^n a_i$. Here, $a_0$ is the set of unallocated objects. \\
			Each player's type/value is given by a function $\theta_i : \Omega \to \R$. We assume that $\theta_i(S) \ge 0$ for all $S \in \Omega$, that is, objects are ``goods'' and not trash.\\
			We further assume that $\theta_i(\emptyset) = 0$ and also that valuations are ``selfish'', that is, $\theta_i(a) = \theta_i(a_i)$ and agent $i$'s valuation does not depend on what the others get.\\

			We claim that in the allocation of goods, the VCG payment for an agent who gets no object in an efficient allocation is equal to $0$.\\
			Fix some $a^* \in \argmax_{a \in A} \sum_{j \in N} \theta_j(a)$ with $a^*_i = 0$. Also let $a^*_{-i} = \argmax_{a \in A} \sum_{j \in N \setminus \{i\}} \theta_j(a)$. Because $a$ is the defined $\argmax$, we have
			\[ p_i^\VCG(\theta) = \sum_{j \in N \setminus \{i\}} \theta_j(a^*_{-i}) - \sum_{j \in N \setminus \{i\}} \theta_j(a^*) \le 0, \]
			so $p_i^\VCG(\theta) = 0$ because it is non-negative.
		\end{fex}

		\begin{fdef}[Individual rationality]
			A mechanism $(f,p)$ is \emph{individually rational} if for all $\theta \in \Theta, i \in N$,
			\[ v_i(f(\theta),\theta_i) - p_i(\theta) \ge 0. \]
		\end{fdef}
		Intuitively, what this says is that no player decides to participate if they are going to incur a negative payoff.

		\begin{fex}[Combinatorial auctions III: Individual rationality]
			Next, we claim that in combinatorial auctions, the VCG mechanism is individually rational. Fix $i \in N$ and define $a^*,a^*_{-i}$ as in the previous example. We have
			\begin{align*}
				\theta_i(a^*) - p_i^\VCG(\theta) &= \sum_{j} \theta_j(a^*) - \sum_{j \ne i} \theta_j(a_{-i}^*) \\
					&= \sum_{j} \theta_j(a^*) - \sum_{j \ne i} \theta_j(a_{-i}^*) \\
					&= \underbrace{\sum_{j} \theta_j(a^*) - \sum_{j} \theta_j(a_{-i}^*)}_{\ge 0\text{ by definition of $a^*$}} + \underbrace{\theta_i(a_{-i}^*)}_{\ge 0} \ge 0.
			\end{align*}
		\end{fex}

		Let us illustrate the concepts in the previous two examples using a more specific example, that of advertising on the internet.

		\begin{fex}[Combinatorial auctions IV: Introduction to internet advertising]
			Internet advertising is very lucrative for numerous reasons: 
			\begin{enumerate}
				\item it is quite easy to gather a lot of user data,
				\item using this data it is possible to classify buyers into categories and measure their interests,
				\item due to the low latency, we can have real-time automated bidding and make decisions on the fly.
			\end{enumerate}
			Some examples of such advertisements are
			\begin{enumerate}
				\item Sponsored search ads: advertisers bid on the keywords entered by users.
				\item Contextual ads: depending on the content of the page, we see a related message.
				\item Display ads: this is akin to more traditional forms of advertising like banner advertisements in newspapers.
			\end{enumerate}
			Modern internet advertising is handled via ``ad exchanges'', which act as an intermediary between the publisher and the client/advertiser. Small businesses customize their ads using these exchanges.\\
			The decision of who gets ad positions on a page is done using \emph{position auctions}.
			\begin{enumerate}
				\item In early position auctions, ads were ordered via bid-per-impression, charging agents based on the bids they place. Newspaper ads is an example of this, but puts all the risk on the advertiser since they are placing the bid without knowing for sure that anyone will see the ad.
				\item Later, we switched to the pay-per-click model, where we rank it based on the number of clicks. This shares the risk with the publisher, since they are paid depending on the number of clicks. If ads are shown but not clicked, the publisher earns nothing.
				\item Today, we rank ad spots based on the product on the probability of click (called click-through rate) and bid value. That is, we rank it based on the expected revenue.
			\end{enumerate}
		\end{fex}

		\begin{fex}[Combinatorial auctions V: A deep-dive into internet advertising]
			Suppose there are $N$ advertisers $\{1,\ldots,n\}$ and $m$ slots $\{1,2,\ldots,m\}$ with $m \ge n$ and every ad is shown. Also assume that $1$ is the ``best'' position and $m$ the ``worst'' (where best and worst are defined more precisely a few paragraphs later).\\

			Let us assume that clicks generate value for the advertisers, and all clicks are valued equally irrespective of where the ad is displayed. The position only affects the click-through rate for that ad. This allows us to decouple the value effect and the position effect.\\
			The expected value of agent $i \in N$ when their ad is shown at position $j \in M$ is $v_{ij} = \CTR_{ij} v_i$, where $\CTR$ is the click-through rate for $i$ at $j$ and $v_i$ is the click value for $i$. $\CTR_{ij}$ has two components: the quality component $e_i$ and the position component $p_j$, so $v_{ij} = p_j \cdot (e_i v_i)$. We have assumed that the position effect is decreasing with position, that is, $p_1 = 1$ and $p_j > p_{j+1}$ for $j = 1,\ldots,m-1$.\\
			Note that $v_i$ is the only private information of the advertisers, and both $p_j,e_i$ are measurable. Search engines estimate $e_i$ as $\hat{e}_i$. If the bidders bid $b_i$, we rank the ads in decreasing order of $\hat{e}_i b_i$.\\

			In this setting, we just have a combinatorial auction where the allocation determines which ad spots each client gets.
			% If we change the $p_j$ to instead determine on the entire set of ad spots won by agent $i$,
			We get that
			\[ v_i(a,\theta_i) = p_{a_i} (\hat{e}_i \theta_i) \]
			for an allocation $a = (a_1,\ldots,a_n)$, where $p_{a_i} = \sum_{j \in a_i} p_j$ and the reported click value is $\theta_i$. Because of allocative efficiency, we pick an allocation $a^* \in \argmax_{a \in A} \sum_{i \in N} v_i(a,\theta_i)$.\\
			We claim that an allocation of slots is efficient iff it is the rank-by-expected-revenue mechanism we have described. This is rather easily proved as the above is just that maximizing a weighted sum.\\
			The slot allocation problem is merely a sorting problem, and is computationally tractable. Now, we must use payments to make it DSIC. A natural candidate is the VCG mechanism, which is (at its core) what is used in ad auctions on Facebook!\\
			Given reported bids $(\theta_1,\ldots,\theta_n)$, assume that $\hat{e}_1 \theta_1 \ge \hat{e}_2 \theta_2 \ge \cdots \ge \hat{e}_n \theta_n$. Assume that the allocation $a^*$ is such that $a_i^* = i$.\\
			Consider $a_{-i}^* = \argmax_{a \in A} \sum_{j \ne i} v_j(a,\theta_j)$. Removing agent $i$ means that players after $i$ get an earlier slot. Then,
			\begin{align*}
				p_i^\VCG(\theta) &= \sum_{j \ne i} v_j(a_{-i}^*,\theta_j) - \sum_{j \ne i} v_j(a^*,\theta_j) \\
					&= \sum_{j=i}^{n-1} p_j\cdot (\hat{e}_{j+1} \theta_{j+1}) - \sum_{j = i}^{n-1} p_j\cdot (\hat{e}_{j+1} \theta_{j+1}) \\
					&= \sum_{j=i}^{n-1} (p_j - p_{j+1}) \hat{e}_{j+1} \theta_{j+1}.
			\end{align*}
			In particular, $p_n^\VCG(b) = 0$. This is the total expected payment. To convert this to the pay-per-click we are interested in, we look at $p_i^\VCG(b)/p_i\hat{e}_i$.
		\end{fex}

		Now, let us look at a couple of advantages and disadvantages of the VCG mechanism. Some clear advantages are:
		\begin{enumerate}
			\item It is DSIC.
			\item It is a no subsidy mechanism if items are goods.
			\item It never charges a losing agent.
			\item It is individually rational to participate, so nobody loses money (at least in the combinatorial auction setting).
		\end{enumerate}
		On the other hand, some criticisms are:
		\begin{enumerate}
			\item It is too transparent and provides no privacy. As a consequence of being a truthful mechanism, it reveals true valuations. Competing companies might not like such information to be made public. Additionally, malicious auctioneers can introduce fake bidders to extract a higher payment from the bidders -- this is relevant in the case where the highest bid is far higher than the second-highest bid.
			\item It is very susceptible to collusion. For example, consider the following public goods setting, with the payments indicated.
			\begin{center}
			\begin{tabular}{|c||c|c||c|}
				\hline
				& F & M & \text{payment} \\
				\hline\hline
				A & $200$ & $0$ & $150$ \\
				\hline
				B & $100$ & $0$ & $50$ \\
				\hline
				C & $0$ & $250$ & $0$ \\ \hline
			\end{tabular}
			\end{center}
			If the first two players collude, they might bid higher, pay much less, and increase their utility!
			\begin{center}
			\begin{tabular}{|c||c|c||c|}
				\hline
				& F & M & \text{payment} \\
				\hline\hline
				A & $250$ & $0$ & $100$ \\
				\hline
				B & $150$ & $0$ & $0$ \\
				\hline
				C & $0$ & $250$ & $0$ \\ \hline
			\end{tabular}
			\end{center}
			\item It is not frugal, and payments can be very large. The VCG is guaranteed to be no deficit, but it can charge a payment much higher than the cost.
			\item Revenue does not weakly increase with the number of players. Consider the following public good settings, with valuations as indicated.
			\begin{center}
			\begin{tabular}{|c||c|c||c|}
				\hline
				& F & M & \text{payment} \\
				\hline\hline
				A & $0$ & $90$ & $0$ \\
				\hline
				B & $100$ & $0$ & $90$ \\
				\hline
			\end{tabular}
			\end{center}
			Now suppose we add a third player to make the game the following.
			\begin{center}
			\begin{tabular}{|c||c|c||c|}
				\hline
				& F & M & \text{payment} \\
				\hline\hline
				A & $0$ & $90$ & $0$ \\
				\hline
				B & $100$ & $0$ & $0$ \\
				\hline
				C & $100$ & $0$ & $0$ \\ \hline
			\end{tabular}
			\end{center}
			\emph{Nobody} is pivotal here.

			 \item It is not budget balanced. While it is a no deficit mechanism, it nearly always keeps a surplus, which is often quite large. The issue here is that the money cannot be redistributed among the same players because this will change payoffs and violate DSIC. If the players are partitioned into two groups and the surplus of one group is redistributed over the other group, it is budget balanced but the overall efficiency is compromised. 
		\end{enumerate}

		The final point suggests that the surplus has to be taken away or eliminated somehow. To understand this tradeoff better, we refer the reader to \cite{nath-sandholm-2019}. Despite these limitations, the VCG mechanism is quite elegant and has many use cases.\\

		Now, let us try to generalize the VCG mechanism to come up with a larger class of DSIC mechanisms in the quasilinear domain. To do this, we use the affine maximizer rule defined in \Cref{ex: payment alloc rules} as
		\[ f^{\text{AM}}(\theta) = \argmax_{a \in A} \left( \sum_{i \in N} w_i \theta_i(a) + \kappa(a) \right), \]
		where the $w_i \ge 0$ are not all zero, and $\kappa : A \to \R$ is any arbitrary function, known as the translation.\\

		When $\kappa \equiv 0$ and all the $w_i$ are equal, we get allocative efficiency again. When $\kappa \equiv 0$ and $w_d = 1$ for some $d$ and $w_i = 0$ for $i \ne d$, we get a dictatorial allocation.\\
		If all the $w_i$ are not identical, then the mechanism is not anonymous. If $\kappa$ is non-constant, then we are giving different importance to different allocations.\\
		In this wider class of affine maximizers, one can try to characterize the mechanisms that satisfy some property.

		\begin{fdef}
			An affine maximizer rule $f^\text{AM}$ with weights $(w_i)_{i \in N}$ and translation $\kappa$ is said to satisfy \emph{independence of non-influential agents} (INA) if for all $i \in N$ with $w_i = 0$,
			\[ f^\AM(\theta_i,\theta_{-i}) = f^\AM(\theta_i',\theta_{-i}) \]
			for all $\theta_i,\theta_i',\theta_{-i}$. 
		\end{fdef}
		This says that tie-breaking is not done on the basis of any weight zero agents.\\
		If INA were not satisfied, the affine maximizer could be manipulated by a weight $0$ agent.

		\begin{ftheo}
			An affine maximizer rule satisfying INA is implementable in dominant strategy.
		\end{ftheo}
		\begin{proof}
			We need to construct a payment function $p^\AM$ such that $(f^\AM,p^\AM)$ is DSIC. Define
			\[ p_i^\AM(\theta_i,\theta_{-i}) = \begin{cases} \frac{1}{w_i} \left( h_i(\theta_{-i}) - \left( \sum_{j \ne i} w_j \theta_j(f^\AM(\theta)) + \kappa(f^\AM(\theta)) \right) \right), & w_i > 0, \\ 0, & w_i = 0. \end{cases} \]
			This is quite similar to the Groves payment.
			If $w_i > 0$, the payoff is
			\begin{align*}
				\theta_i(f^\AM(\theta_i,\theta_{-i})) - p_i^\AM(\theta_i,\theta_{-i}) &= \frac{1}{w_i} \left( \sum_{j \in N} w_j \theta_j(f^\AM(\theta_i,\theta_{-i})) + \kappa(f^\AM(\theta)) - h_i(\theta_{-i}) \right) \\
					&\ge \frac{1}{w_i} \left( \sum_{j \in N} w_j \theta_j(f^\AM(\theta_i',\theta_{-i})) + \kappa(f^\AM(\theta_i',\theta_{-i})) - h_i(\theta_{-i}) \right) \\
					&= \theta_i(f^\AM(\theta_i',\theta_{-i})) - p_i^\AM(\theta_i',\theta_{-i}),
			\end{align*}
			where the second step is by the definition of the affine maximizer rule. The case where $w_i = 0$ follows due to INA.
		\end{proof}

		% Similar to the Gibbard-Satterthwaite Theorem, what if the 
		Now, consider the scenario where $\Theta_i$ has all valuation functions $\theta_i : A \to \R$ with no restriction on the functions. In this unrestricted space, we can characterize the class of DSIC mechanisms in the quasilinear domain.

		\begin{ftheo}[Roberts]
			Let $A$ be finite with $|A| \ge 3$. If the type space is unrestricted, any onto and dominant strategy implementable allocation rule is an affine maximizer.
		\end{ftheo}

		We omit the proof of the above, but the interested reader can find one at \cite{roberts}.

	\subsubsection{Indivisible object allocation}

		In the single indivisible object allocation setting, recall that due to the truthfulness of VCG, \Cref{vcg obj allocation} implies that the second-price auction mechanism is truthful.\\

		The setup is as follows. Each agent $i$ has a type set $T_i \subseteq \R$, and $t_i \in T_i$ denotes the value of agent $i$ if they win the object. An allocation $a$ is a vector that represents the \emph{probability} of winning the object, so the set of allocations is
		\[ \Delta A = \{ a \in [0,1]^n : \sum_{i=1}^n a_i = 1 \}. \]
		The allocation rule is some $f : T_1 \times T_2 \times \cdots \times T_n \to \Delta A$. The valuation is said to be in the \emph{product form} if it is given by $v_i(a,t_i)$ equal to $a_i\cdot t_i$, namely the expected valuation. That is, $f_i(t_i,t_{-i})$ is the probability of winning the object for agent $i$ when the type profile is $(t_i,t_{-i})$.\\

		In the second-price auction, also called the \emph{Vickrey} auction, the types are $v_i$, and defining $t_{-i}^{(2)} = \max_{j \ne i} v_j$, agent $i$ wins if $v_i > t_{-i}^{(2)}$ and loses if $v_i < t_{-i}^{(2)}$. Some tiebreaking rule decides the equality case. Because the payment is $t_{-i}^{(2)}$ for the winner $i$, the utility is zero if there is a tie. That is,
		\[ u_i = \begin{cases} 0, & v_i \le t_{-i}^{(2)}, \\ v_i - t_{-i}^{(2)}, & v_i > t_{-i}^{(2)}. \end{cases} \]
		Observe the following.
		\begin{enumerate}
			\item As a function of $v_i$ when all the other $v_j$ are fixed, the utility is convex.
			\item Wherever differentiable, the utility's derivative coincides with the allocation probability.
		\end{enumerate}

		We now describe some known results from convex analysis.

		\begin{fact}
			Convex functions are continuous on the interior of their domain.
		\end{fact}

		% \begin{fact}
		% 	Convex functions are differentiable almost everywhere.
		% \end{fact}
		\begin{definition}
			Let $g : I \to \R$ be convex. For any $x \in I$, $x^*$ is a \emph{subgradient} of $g$ at $x^*$ if
			\[ g(z) \ge g(x) + x^*\cdot(z-x) \]
			for all $z \in I$.
		\end{definition}

		% Note that at points where the function is differentiable, the subgradient is unique.

		\begin{fact}
			Let $g : I \to \R$ be convex. For every $x \in I$, a subgradient of $g$ exists. Further, if $x$ is in the interior of $I$ and $g$ is differentiable at $x$, $g'(x)$ is the unique subgradient at $x$.
		\end{fact}

		\begin{fact}
			Let $I' \subseteq I$ be the set of points where $g$ is differentiable. Then, $I \setminus I'$ is of measure $0$.
		\end{fact}
		``Measure zero'' means that there is no interval contained in this set.

		\begin{fact}
			 Further, the set of subgradients at a point forms a convex set. More precisely, it is equal to $[g_-'(x),g_+'(x)]$.
		\end{fact}

		Denote the set of subgradients of $g$ at $x \in I$ as $\partial g(x)$. Then, we have that $\partial g(x)$ is non-empty and convex at all $x \in I$, and if $g$ is differentiable at $x$, it is a singleton $\{g'(x)\}$.\\
		Similar to the non-decreasingness of the derivative of a differentiable convex function, we get the following.

		\begin{lemma}
			\label{lem: subgrad nondec}
			Let $g : I \to \R$ be a convex function. Let $\varphi : I \to \R$ a subgradient function, that is, $\varphi(z) \in \partial g(z)$ for all $z \in I$. Then, $\varphi$ is non-decreasing, that is, for all $x,y \in I$ with $x > y$, $\varphi(x) \ge \varphi(y)$.
		\end{lemma}

		\begin{lemma}
			\label{lem: subgrad int}
			Let $g : I \to \R$ be a convex function. Then, for any $x,y \in I$,
			\[ g(x) = g(y) + \int_y^x \varphi(z) \dif z, \]
			where $\varphi:I \to \R$ is a subgradient function of $g$.
		\end{lemma}

		\begin{fdef}
			An allocation rule is \emph{non-decreasing} if for every agent $i \in N$ and $s_i,t_i \in T_i$ with $t_i > s_i$ and $t_{-i} \in T_{-i}$,
			\[ f_i(t_i,t_{-i}) \ge f_i(s_i,t_{-i}). \]
		\end{fdef}

		\begin{ftheo}[Myerson]
			\label{theo: myerson}
			Suppose $T_i = [0,b_i]$ for all $i \in N$, and the valuations are in the product form. A mechanism $(f,p)$ is DSIC iff
			\begin{enumerate}[label=(\alph*)]
				\item $f$ is non-decreasing and
				\item payments are given by
				\[ p_i(t_i,t_{-i}) = p_i(0,t_{-i}) + t_i f_i(t_i,t_{-i}) - \int_0^{t_i} f_i(x,t_{-i}) \dif x \]
				for all $t_i,t_{-i},i$.
			\end{enumerate}
		\end{ftheo}
		\begin{proof}
			Let us first prove the forward direction. The utility of agent $i$ is
			\[ u_i(t_i,t_{-i}) = t_if_i(t_i,t_{-i}) - p_i(t_i,t_{-i}). \]
			Due to DSIC-ness,
			\begin{align*}
				u_i(t_i,t_{-i}) &= t_if(t_i,t_{-i}) - p_i(t_i,t_{-i}) \\
					&\ge t_i f(s_i,t_{-i}) - p_i(s_i,t_{-i}) \\
					&= s_if_i(s_i,t_{-i}) - p_i(s_i,t_{-i}) + f_i(s_i,t_{-i})(t_i - s_i) \\
					&= u_i(s_i,t_{-i}) + f_i(s_i,t_{-i}) (t_i-s_i).
			\end{align*}
			Fixing $t_{-i}$, define $g(t_i) = u_i(t_i,t_{-i})$ and $\varphi(t_i) = f_i(t_i,t_{-i})$. Then, the above just says that
			\[ g(t_i) \ge g(s_i) + \varphi(s_i) (t_i-s_i), \]
			so $\varphi$ is a subgradient function of $g$. Next, let us show that $g$ is convex. Pick $x_i,z_i \in T_i$, and let $y_i = \lambda x_i + (1-\lambda) z_i$ for some $\lambda \in [0,1]$. As seen above,
			\begin{align*}
				g(x_i) &\ge g(y_i) + \varphi(y_i)(x_i-y_i) \text{ and} \\
				g(z_i) &\ge g(y_i) + \varphi(y_i)(z_i-y_i).
			\end{align*}
			Taking a convex combination of the two equations above,
			\[ \lambda g(x_i) + (1-\lambda) g(z_i) \ge g(y_i) + \varphi(y_i)\underbrace{(\lambda x_i + (1-\lambda z_i) - y_i)}_{0}, \]
			so $g$ is convex. \Cref{lem: subgrad nondec} proves the first part, and \Cref{lem: subgrad int} proves the second.\\

			The backward direction is straightforward. Assuming for simplicity that $p_i(0,t_{-i}) = 0$,
			\[ \left(t_if_i(t_i,t_{-i}) - p_i(t_i,t_{-i})\right) - \left(t_if_i(s_i,t_{-i}) - p_i(s_i,t_{-i})\right) = (s_i-t_i)f_i(s_i,t_{-i}) + \int_{s_i}^{t_i} f_i(x,t_{-i}) \dif x \ge 0. \qedhere \]
		\end{proof}

		\begin{fcor}
			An allocation rule in the single object allocation setting is implementable in dominant strategy iff it is non-decreasing.
		\end{fcor}

		\begin{fex}[Single object allocation mechanisms]
			Let us look at some truthful single object allocation mechanisms.
			\begin{enumerate}
				\item The constant allocation mechanism is non-decreasing and the payment is some constant.
				\item The dictatorial allocation mechanism gives the object only to the dictator, which is non-decreasing, and the payment is some constant again.
				\item In a second-price auction, $p_i(0,t_{-i})$ and $f_i(\cdot,t_{-i})$ is a step function with the step at $t_{-i}^{(2)}$.
				\item Efficient allocation with a reserve price is also non-decreasing. This is a modification of the second-price auction such that if the highest value is below some reserve price $r$, nobody gets the object. Similar to the second-price auction, here, $f_i(\cdot,t_{-i})$ is a step function with the step at $\max\{t_{-i}^{(2)},r\}$.
				\item Let us look at an uncommon allocation rule that might be difficult to arrive at without Myerson's rule. Suppose $N = \{1,2\}$ and $A = \{a_0,a_1,a_2\}$ ($a_0$ meaning unsold, and $a_i$ for $i \ne 0$ meaning that the object is given to $i$). Given a type profile $t$, the seller computes $\max\{2,t_1^2,t_2^3\}$, and selects that $a_i$ corresponding to the maximum, breaking ties as $0>1>2$. Player $1$ gets the object if $t_1 > \sqrt{\max\{2,t_2^3\}}$ and player $2$ gets the object if $t_2 > \sqrt[3]{\max\{2,t_1^2\}}$. Both of these are non-decreasing step functions.
			\end{enumerate}
		\end{fex}

		\begin{fdef}
			A mechanism $(f,p)$ is \emph{ex-post individually rational} if
			\[ t_i f_i(t_i,t_{-i}) - p_i(t_i,t_{-i}) \ge 0 \]
			for all $t \in T$ and $i \in N$.
		\end{fdef}
		That is, even after all agents have revealed their types, participation is weakly preferred. We refer to the above as just individually rational.

		\begin{flem}
			\label{lem: dsic ir single object}
			Let $(f,p)$ be a DSIC mechanism in the single object allocation setting.
			\begin{enumerate}[label=(\alph*)]
				\item $(f,p)$ is individually rational iff $p_i(0,t_{-i}) \le 0$ for all $t_{-i} \in T_{-i}$ and $i \in N$.
				\item $(f,p)$ is individually rational and is no-subsidy iff $p_i(0,t_{-i}) = 0$ for all $t_{-i} \in T_{-i}$ and $i \in N$.
			\end{enumerate}
		\end{flem}
		\begin{proof}
			\phantom{pain}
			\begin{enumerate}[label=(\alph*)]
				\item Using individual rationality in the $t_i = 0$ case gives the forward direction of the first part. For the converse, using DSIC-ness, the payoff of $i$ is
				\[ t_i f_i(t_i,t_{-i}) - p_i(t_i,t_{-i}) = - p_i(0,t_{-i}) + \int_{0}^{t_i} f_i(x,t_{-i}) \dif x \ge 0. \]
				
				 \item This is direct since we have $p_i(0,t_{-i}) \le 0$ from the first part, and $p_i(0,t_{-i}) \ge 0$ due to no-subsidy. \qedhere
			\end{enumerate}
		\end{proof}

		Let us next describe some non-Vickrey auctions, with a focus on budget balanced mechanisms (recall what this means from \Cref{ex: payment rules}) or something close to one.

		\begin{fex}
			\phantom{pain}
			\begin{enumerate}
				\item The object goes to the highest bidder, and the payment is such that everyone is compensated some amount.\\
				The highest two bidders are compensated $1/n$ of the third highest bid, and everyone else receives $1/n$ of the second highest bid. Assuming without loss of generality that $t_1 > t_2 > \cdots > t_n$, agent $1$ pays
				\[ -\frac{1}{n}t_3 + t_1 - \int_0^{t_1} f_1(x,t_{-1}) \dif x = t_2 - \frac{1}{n} t_3, \]
				agent $2$ pays $-t_3/n$, and everyone else pays $-t_2/n$. The total payment is
				\[ t_2 - \frac{1}{n}t_3 - \frac{1}{n}t_3 - \frac{n-2}{n} t_2 = \frac{2}{n}(t_2 - t_3), \]
				which tends to $0$ for large $n$.

				\item Allocate the object with probability $\left(1 - \frac{1}{n}\right)$ to the highest bidder, and with probability $\frac{1}{n}$ to the second highest bidder. We also set $p_i(0,t_{-i}) = \frac{-1}{n} t_{-i}^{(2)}$. Then, agent $1$ pays
				\[ -\frac{1}{n}t_3 + \left( 1 - \frac{1}{n} \right)t_1 - \underbrace{\frac{1}{n}(t_2-t_3)}_{\int_{t_3}^{t_2} \frac{1}{n} \dif x } - \underbrace{\left(1 - \frac{1}{n}\right)(t_1-t_2)}_{\int_{t_2}^{t_1} \left(1-\frac{1}{n}\right) \dif x } = \left( 1 - \frac{2}{n} \right)t_2, \]
				agent $2$ pays
				\[ -\frac{1}{n}t_3 + \frac{1}{n}t_2 - \frac{1}{n}(t_2-t_3) = 0, \]
				and everyone else pays $-t_2/n$. The sum of all these is $0$.
			\end{enumerate}
		\end{fex}

	\subsection{Optimal mechanism design}

		We now come to another question: how do we maximize the revenue of the auctioneer? We begin with the indivisible object allocation setting from the previous subsubsection. \\
		Before getting to the details, we must set up some notation.

		Let $T_i = [0,b_i]$ for each $i$ and $G$ a common prior over $T$ with density $g$. We let $G_{-i}(s_{-i} | s_i)$ to be the conditional distribution over $T_{-i}$ given that $i$'s type is $s_i$, having density $g_{-i}(s_{-i}| s_i)$.
		$g_{-i}$ is derived using Bayes' rule.

		Any mechanism $(f,p_1,\ldots,p_n)$ induces an expected allocation and payment rule $(\alpha,\pi)$. Here,
		\[ \alpha_i(s_i | t_i) = \int_{s_{-i} \in T_{-i}} f_i(s_i,s_{-i}) g_{-i}(s_{-i}| t_i) \dif s_{-i}, \]
		where $s_i$ is the reported type, $t_i$ is the true type, $f_i$ is the probabilistic allocation as before, and $g_{-i}$ encodes the probabilistic knowledge of the types of the other agents in the common prior. The conditioning on $t_i$ means that we are conditioning on the true type being $t_i$. The expected payment is
		\[ \pi_i(s_i| t_i) = \int_{s_{-i} \in T_{-i}} p_i(s_i,s_{-i}) g_{-i}(s_{-i} | t_i) \dif s_{-i}. \]
		The expected utility of agent $i$ on reporting $s_i$ is
		\[ t_i \alpha_i(s_i | t_i) - \pi_i(s_i | t_i). \]

		\begin{fdef}[Bayesian Incentive Compatibility]
			A mechanism $(f,p)$ is \emph{Bayesian incentive compatible} (BIC) if for all $i \in N$, $s_i,t_i \in T_i$,
			\[ t_i \alpha_i(t_i | t_i) - \pi_i(t_i | t_i) \ge t_i \alpha_i(s_i | t_i) - \pi_i(s_i | t_i). \]
			$f$ is Bayesian implementable if there exists some $p$ such that $(f,p)$ is BIC.\\
		\end{fdef}
		Now, let us assume that the priors are independent. That is, agent $i$'s value is drawn from a distribution $G_i$ with density $g_i$ independently from the other agents, so
		\[ g(s_1,s_2,\ldots,s_n) = \prod_{i \in N} g_i(s_i) \]
		and
		\[ g(s_{-i} | t_i) = \prod_{j \ne i} g_j(s_j). \]
		We use the shorthand $\alpha(t_i) = \alpha(t_i | t_i)$.

		\begin{fdef}
			An allocation rule is \emph{non-decreasing in expectation} (NDE) if for all $i \in N, s_i,t_i \in T_i$ with $s_i < t_i$, $\alpha_i(s_i) \le \alpha_i(t_i)$.
		\end{fdef}
		It is easily seen that non-decreasing rules are non-decreasing in expectation.\\
		Similar to Myerson's characterization, we get the following Bayesian version.

		\begin{ftheo}
			\label{bic char}
			A mechanism $(f,p)$ in the independent prior setting is BIC iff
			\begin{enumerate}
				\item $f$ is non-decreasing in expectation and
				\item $p_i$ satisfies
				\[ \pi_i(t_i) = \pi_i(0) + t_i \alpha(t_i) - \int_0^{t_i} \alpha_i(x) \dif x. \]
			\end{enumerate}
		\end{ftheo}
		The proof is very similar to that of \nameref{theo: myerson}, and we omit it.

		\begin{fex}[NDE rules need not be ND]
			Let us look at one rule that is NDE but not non-decreasing. Suppose there are two players with $5$ types each, and all $5$ types are equally likely.
			\[
			\begin{pmatrix}
				2 & 2 & 2 & 2 & 2 \\
				2 & 2 & 2 & 2 & 1 \\
				2 & 2 & 2 & 1 & 2 \\
				2 & 2 & 2 & 1 & 1 \\
				2 & 2 & 1 & 2 & 1
			\end{pmatrix}
			\]
			Here, the $ij$th entry depicts who wins if player $2$ chooses type $i$ and player $1$ chooses type $j$. Suppose the true types are $t_1 = t_2 = 3$. For player $1$, the allocation is indeed non-decreasing in expectation since $\alpha_1(t_1')$ is equal to $0,0,1/5,2/5,3/5$ for $t_1' = 1,2,3,4,5$. We can similarly check it for player $2$. However, it is not non-decreasing because $f(4,3) = 1$ and $f(5,3) = 0$ although $5 > 4$.
		\end{fex}

		Individual rationality now becomes the following.
		\begin{fdef}
			A mechanism $(f,p)$ is \emph{interim individually rational} (IIR) if for every bidder $i \in N, t_i \in T_i$,
			\[ t_i \alpha_i(t_i) - \pi_i(t_i) \ge 0. \]
		\end{fdef}

		Similar to \Cref{lem: dsic ir single object}, we get the following.
		\begin{flem}
			\label{bic iir}
			A BIC mechanism $(f,p)$ is IIR iff for all $i \in N$,
			\[ \pi_i(0) \le 0. \]
		\end{flem}
		The proof is again quite similar.\\

		Let us return to our question of revenue maximization. Suppose we have a single agent for now, with type set $T = [0,\beta]$. Our mechanism is $(f,p)$, where $f : [0,\beta] \to [0,1]$ and $p : [0,\beta] \to \R$. Incentive compatibility (BIC and DSIC are equivalent since there is only one agent) gives that
		\[ tf(t) - p(t) \ge tf(s) - p(s) \]
		for all $t,s \in T$. Individual rationality gives that
		\[ tf(t) - p(t) \ge 0 \]
		for all $t \in T$. The expected revenue earned by a mechanism is
		\[ \pi^M = \int_0^\beta p(t) g(t) \dif t. \]
		We need to find a mechanism $M^*$ in the class of incentive-compatible and individually rational mechanisms such that $\pi^{M^*} \ge \pi^M$ for all $M$. Call $M^*$ the \emph{optimal mechanism}. By the characterization lemmas \Cref{theo: myerson,lem: dsic ir single object}, we have
		\begin{align*}
			p(t) &= p(0) + tf(t) - \int_0^t f(x) \dif x \text{ and} \\
			p(0) &\le 0.
		\end{align*}
		In order to maximize revenue, $p(0) = 0$. So, the payment formula is
		\[ p(t) = tf(t) - \int_0^t f(x) \dif x. \]
		The expected revenue is
		\[ \pi^f = \int_0^\beta \left( tf(t) - \int_0^t f(x) \dif x \right) g(t) \dif t, \]
		which we want to maximize by choosing an appropriate $f$.

		Now, we have
		\begin{align*}
			\pi^f &= \int_0^\beta \left( tf(t) - \int_0^t f(x) \dif x \right) g(t) \dif t \\
				&= \int_0^\beta tf(t)g(t) \dif t - \int_0^\beta \left(\int_0^t f(x) \dif x\right) g(t) \dif t \\
				&= \int_0^\beta tf(t)g(t) \dif t - \int_0^\beta \left(\int_x^\beta g(t) \dif t\right) f(x) \dif x \\
				&= \int_0^\beta tf(t)g(t) \dif t - \int_0^\beta \left(\int_t^\beta g(x) \dif x\right) f(t) \dif t \\
				&= \int_0^\beta \left(tf(t)g(t) - f(t)\left(\int_t^\beta g(x) \dif x\right)\right) \dif t \\
				&= \int_0^\beta \left(tf(t)g(t) - f(t)(1-G(t))\right) \dif t \\
			\pi^f &= \int_0^\beta \left( t - \frac{1-G(t)}{g(t)} \right) g(t)f(t) \dif t.
		\end{align*}
		
		We want to figure out the $f$ that maximizes
		\begin{equation}
			\label{eqn: opt1}
			\max_{\text{non-decreasing $f$}} \int_0^\beta \left( t - \frac{1-G(t)}{g(t)} \right)g(t)f(t) \dif t.
		\end{equation}
		Let us assume that $G$ satisfies the \emph{monotone hazard rate} condition, which means that $\frac{g(x)}{1-G(x)}$ is non-decreasing in $x$. Standard distributions such as the uniform and exponential distributions satisfy this.

		\begin{fact}
			If $G$ satisfies the MHR condition, there is a unique solution to
			\[ x = \frac{1-G(x)}{g(x)}. \]
		\end{fact}
		Indeed, the right-hand side is non-increasing and the left is strictly increasing. Set
		\[ w(x) = x - \frac{1-G(x)}{g(x)}, \]
		and let $w(x^*) = 0$. Then, $w(x) > 0$ for $x > x^*$ and $w(x) < 0$ for $x < x^*$. The unrestricted solution to \cref{eqn: opt1} is therefore
		\begin{equation}
			\label{eqn: optimal dist single agent}
			f(t) =
			\begin{cases}
				0, & t < x^*, \\
				1, & t > x^*, \\
				\alpha, & t = x^*,
			\end{cases}
		\end{equation}
		where $\alpha \in [0,1]$. Note that this is basically just a step function. This $f$ is also non-decreasing and is therefore the optimal solution of \cref{eqn: opt1}.

		\begin{ftheo}
			In the single agent single object allocation setting, a mechanism $(f,p)$ under the MHR condition on the prior is optimal iff
			\begin{enumerate}
				\item $f$ is given by \Cref{eqn: optimal dist single agent}.
				\item For all $t \in T$,
				\[ p(t) = \begin{cases} x^*, & t \ge x^*, \\ 0, & \text{otherwise.} \end{cases} \]
			\end{enumerate}
		\end{ftheo}

		Let us now shift to the multiple agent setting. Call a mechanism optimal if it is BIC, IIR, and maximizes revenue. Recalling \Cref{bic char,bic iir}, the expected payment made by agent $i$ is
		\[ \int_{T_i} \pi_i(t_i) g_i(t_i) \dif t_i, \]
		where $T_i = [0,b_i]$. Exactly as before, if we set
		\[ w_i(t_i) = t_i - \frac{1-G_i(t_i)}{g_i(t_i)}, \]
		called the \emph{virtual valuation} of player $i$, the expected payment simplifies to
		\[ \int_0^{b_i} w_i(t_i) g_i(t_i) \alpha_i(t_i). \]
		Substituting $\alpha_{i}$, this gives the payment as
		\[ \int_T w_i(t_i) f_i(t) g(t) \dif t. \]
		Therefore, the total revenue generated by all players is
		\[ \sum_{i \in N} \int_{T} w_i(t_i) f_i(t) g(t) \dif t = \int_{T} \left(\sum_{i \in N} w_i(t_i) f_i(t)\right) g(t) \dif t \]
		which we wish to maximize, subject to $f$ being NDE. As before, if we try to solve the unconstrained optimization problem, we get
		\begin{equation}
			\label{eqn: multi agent optimal}
			f_i(t) = \begin{cases} 1, & w_i(t_i) \ge w_j(t_j) \text{ for all $j$ and $w_i(t_i) \ge 0$}, \\ 0, & \text{otherwise,} \end{cases}
		\end{equation}
		However, this can result in $f$s that are not NDE. See \cite{myerson} for details. So, like the MHR constraint earlier, we enforce something here as well.

		\begin{fdef}
			A virtual valuation $v_i$ is \emph{regular} if for all $s_i,t_i \in T_i$ with $s_i < t_i$, $w_i(s_i) < w_i(t_i)$.
		\end{fdef}
		This is weaker than MHR.

		Regularity says that $w_i(t_i) > w_i(s_i)$ for all $t_i > s_i$. As a result, the optimal allocation rule \cref{eqn: multi agent optimal} also satisfies
		\[ f_i(t_i,t_{-i}) \ge f_i(s_i,t_{-i}), \]
		so $f$ is non-decreasing, and NDE in particular.
		
		Note that this $f$ is deterministic (in the sense that it either allocates the whole object or nothing). Therefore, not only is it BIC and IIR, it is DSIC and IR.

		\begin{ftheo}
			Suppose every agent's valuation is regular. Define the mechanism $(f,p)$ as follows.
			\begin{enumerate}
				\item If $w_i(t_i) < 0$ for all $i \in N$, $f_i(t) = 0$ for all $i \in N$.
				\item Otherwise,
				\[ f_i(t) = \begin{cases} 1, & w_i(t_i) \ge w_j(t_j) \text{ for all $j$} \\ 0, & \text{otherwise,} \end{cases} \]
				with ties being broken arbitrarily.
				\item Payments are given by
				\[ p_i(t) = \begin{cases} 0, & f_i(t) = 0, \\ \max\{w_i^{-1}(0), \kappa_i^*(t_{-i})\}, & f_i(t) = 1. \end{cases} \]
			\end{enumerate}
			Then, $(f,p)$ is an optimal mechanism.
		\end{ftheo}
		Above, $w_i^{-1}(0)$ is the value of $t_i$ such that $w_i(t_i) = 0$ and
		\[ \kappa_i^*(t_{-i}) = \inf\{t_i : f_i(t_i,t_{-i}) = 1\}, \]
		the smallest value of $t_i$ where $i$ starts to win.\\
		This can be thought of as something like a second-price auction with a reserve price.

		\begin{fex}[Uniform independent priors]
			Suppose there are two buyers with $T_1 = [0,12]$ and $T_2 = [0,18]$, with a uniform independent prior. Then,
			\[ w_1(t_1) = t_1 - \frac{1-G_1(t_1)}{g_1(t_1)} = t_1 - \frac{1-\frac{t_1}{12}}{\frac{1}{12}} = 2t_1-12 \]
			and $w_2(t_2) = 2t_2-18$. Then, we can tabulate some data as follows. Note that gradual change of when each player's virtual valuation becomes non-negative, and also when they start winning.
			\begin{center}
			\begin{tabular}{|c|c|c|c|c|}
				\hline $t_1$ & $t_2$ & allocation & $p_1$ & $p_2$ \\ \hline\hline
				$4$ & $8$ & unsold & $0$ & $0$ \\
				$2$ & $12$ & $2$ & $0$ & $9$ \\
				$6$ & $6$ & $1$ & $6$ & $0$ \\
				$9$ & $9$ & $1$ & $6$ & $0$ \\
				$8$ & $15$ & $2$ & $0$ & $11$ \\ \hline
			\end{tabular}
			\end{center}
		\end{fex}

		\begin{fex}[Symmetric bidders]
			Suppose the valuations are drawn from the same distribution, so $T_i = T$, the $g_i$ are some common $g$, and all the common valuations $w_i$ are equal to $w$. Here, $w(t_i) > w(t_j)$ iff $t_i > t_j$, so the object goes to the higher bidder, and it is not sold if $w^{-1}(0) > t_i$. This is precisely a second-price auction with a reserve price of $w^{-1}(0)$, and is efficient. 
		\end{fex}

		Finally, we discuss a few other optimal mechanisms.

		\begin{ftheo}[Green-Laffont-Holmstr\"{o}m]
			If the type space is ``sufficiently rich'', every efficient DSIC mechanism is a Groves mechanism.
		\end{ftheo}
		% ``Sufficient richness'' means that everything is feasible in some sense.
		\begin{proof}[Proof sketch]
			Suppose there are two alternatives $A = \{a,b\}$. Consider the welfares $\sum_i t_i(a)$ and $\sum_i t_i(b)$. We choose $a$ if the former is greater than the latter. Fix the valuations of the other agents to $t_{-i}$, and fix the value of $i$ at alternative $b$ at $t_i(b)$. Then, there exists some threshold $t_i^*(a)$ such that for all $t_i(a) \ge t_i^*(a)$, $a$ is the outcome, and for $t_i(a) < t_i^*(a)$, $b$ is the outcome.\\
			Using DSIC-ness for $t_i^*(a) + \epsilon = t_i(a)$, we get
			\[ t_i^*(a) + \epsilon - p_{ia} \ge t_i(b) - p_{ib} \]
			and similarly,
			\[ t_i(b) - p_{ib} \ge t_i^*(a) - \delta - p_{ia}. \]
			Because $\epsilon,\delta$ are arbitrary, $t_i^*(a) - p_{ia} = t_i(b) - p_{ib}$. Because $t_i^*(a)$ is the reshold of the efficient outcome,
			\[ t_i^*(a) + \sum_{j \ne i} t_j(a) = t_i(b) + \sum_{j \ne i} t_j(b). \]
			Combining these two,
			\[ p_{ia} - p_{ib} == \sum_{j \ne i} t_j(b) - t_j(a). \]
			Therefore, the payment is of the form $p_{ix} = h_i(t_{-i}) - \sum_{j \ne i} t_j(x)$.
		\end{proof}

		\begin{ftheo}[Green-Laffont]
			No Groves mechanism is budget-balanced.
		\end{ftheo}

		\begin{fcor}
			If the type space is sufficiently rich, no efficient mechanism is both DSIC and budget-balanced. 
		\end{fcor}

		Given this, we try to weaken the notion of DSIC-ness. Allocation is still efficient, and payment is now defined via a prior as
		\[ \delta_i(t_i) = \E_{t_{-i} | t_i} \sum_{j \ne i} t_j(a^*(t)). \]
		For example,
		\begin{align*}
			a^*(t) \in \argmax_{a \in A} \sum_{i \in N} t_i(a) \\
			p_i^\text{dAGVA} = \frac{1}{n-1} \sum_{j \ne i} \delta_j(t_j) - \delta_i(t_i),
		\end{align*}
		named after d'Aspremont, Gerard-Varet, Arrow, and is also known as the ``expected VCG'' mechanism. It can be shown that the dAGVA mechanism is efficient, BIC, and budget-balanced. However, it is not IIR.

		\begin{ftheo}[Myerson-Satterthwaite]
			In a bilateral trade (that involves two types of agents, seller and buyer), no mechanism can be simultaneously BIC, efficient, IIR, and budget-balanced.
		\end{ftheo}