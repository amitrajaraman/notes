\section{Social Choice}

\subsection{Introduction}

	Mechanism design is something of an inverse of game theory, given the desired objects/outcomes, our task is to set the rules of the game.\\
	Some common examples of this are elections, resource allocation, matching students to universities, etc.

	Let $N$ be a set of players, $X$ a set of outcomes, and $\Theta_i$ a set of private information of each agent $i$. Each element $\theta_i \in \Theta_i$ is called a \emph{type}.\\

	The type manifests in the preferences over the outcomes. We shall look at two ways this can happen.
	\begin{enumerate}
	 	\item \emph{Ordinal}: $\theta_i$ defines an ordering over the outcomes, which describes a preference order. It does not describe how much something is preferred, however.
	 	\item \emph{Cardinal}: A utility function $u_i$ maps an outcome/type pair to real numbers. In the \emph{private value model}, $u_i$ is a map $X \times \Theta_i \to \R$. In the \emph{interdependent value model}, $u_i$ is a map $X \times \Theta \to \R$.
	\end{enumerate}

	\begin{fex}
		Let us look at the example of voting. Here, $X$ is the set of candidates, and each $\theta_i$ is a ranking over the candidates. For example, $(a,b,c)$ means that the voter prefers $a$ over $b$ over $c$. \\
		Another example is single object allocation. Each outcome is $x = (a,p) \in X$, where $a = (a_1,\ldots,a_n)$, where each $a_i \in \{0,1\}$, and at most one of the $a_i$s is $1$ and $p = (p_1,\ldots,p_n)$, where $p_i$ is the payment charged to $i$. $\theta_i$ is the amount $i$ values the object. The utility is given by $u_i(x,\theta_i) = a_i\theta_i - p_i$.
	\end{fex}

	Now, the designer has a certain objective, captured by a \emph{social choice function} (SCF) $f : \Theta_1 \times \cdots \times \Theta_n \to X$. For example, in voting, if there is a candidate who beats everyone else in pairwise contests, we would like him to be chosen as the winner. In public project choice, where $\theta_i : X \to \R$ is the value of each project, we should pick $f(\theta) = \argmax_{x \in X} \sum_{i \in N} \theta_i(x)$.\\
	To create a game where $f(\theta)$ emerges as the outcome as an equilibrium, we require mechanism design.

	\begin{fdef}
		A(n indirect) mechanism is a collection of message spaces and a decision rule $\langle M_1,\ldots,M_n,g\rangle$, where $M_i$ is the message space of agent $i$, and $g : M_1 \times \cdots \times M_n \to X$. A direct mechanism is the specific case where $M_i = \Theta_i$ and $g \equiv f$.
	\end{fdef}

	We shall see soon that it suffices to look at direct mechanisms.\\
	All subsequent definitions assume cardinal preferences, but they can be replaced with ordinal preferences quite simply.

	\begin{fdef}
		In a mechanism $\langle M_1,\ldots,M_n,g\rangle$, a message $m_i$ is \emph{weakly dominant} for player $i$ at $\theta_i$ if
		\begin{equation}
			\label{eqn: weakly dominant}
			u_i(g(m_i,\widetilde{m}_{-i}),\theta_i) \ge u_i(g(m_i',\widetilde{m}_{-i}),\theta_i)
		\end{equation}
		for all $\widetilde{m}_{-i},m_i'$.
	\end{fdef}

	\begin{fdef}[Dominant strategy implementability]
		 An SCF $f : \Theta \to X$ is \emph{implemented} in dominant strategies by $\langle M_1,\ldots,M_n,g\rangle$ if
		 \begin{enumerate}
		 	\item there exists a message mapping $s_i : \Theta_i \to M_i$ such that $s_i(\theta_i)$ is a dominant strategy for agent $i$ at $\theta_i$, and
		 	\item $g(s_1(\theta_1),\ldots,s_n(\theta_n)) = f(\theta)$ for all $\theta \in \Theta$.
		 \end{enumerate}
		We say that SCF $f$ is \emph{dominant strategy implementable} (DSI) by $\langle M_1,\ldots,M_n,g\rangle$.
	\end{fdef}

	\begin{fdef}[Dominant strategy incentive compatibility]
		\label{def: dsic}
		A direct mechanism $\langle \Theta_1,\ldots,\Theta_n,f\rangle$ is \emph{dominant strategy incentive compatible} (DSIC) if
		\begin{equation}
			\label{eqn: dsic}
			u_i(f(\theta_i,\widetilde{\theta}_{-i}),\theta_i) \ge u_i(f(\theta_i',\widetilde{\theta}_{-i}),\theta_i)
		\end{equation}
		for all $\theta_i,\theta_i',\widetilde{\theta}_{-i},i$.
	\end{fdef}

	To determine if an SCF $f$ is DSI, it seems that we must search over all possible indirect mechanisms.

	\begin{ftheo}[Revelation principle]
		If there exists an indirect mechanism that implements $f$ in dominant strategies, then $f$ is DSIC.
	\end{ftheo}
	This means that we can focus on DSIC mechanisms without loss of generality.
	\begin{proof}
		Let $f$ be implemented by $\langle M_1,\ldots,M_n,g\rangle$, and fix $s_i : \Theta_i \to M_i$ as in the definition. Set $m_i' = s_i(\theta_i'), \widetilde{m}_{-i} = s_{-i}(\widetilde{\theta}_{-i})$ in \Cref{eqn: weakly dominant}, to get
		\[ u_i(\underbrace{g(s_i(\theta_i),s_{-i}(\widetilde{\theta}_{-i}))}_{f(\theta_i,\widetilde\theta_{-i})},\theta_i) \ge u_i(\underbrace{g(s_i(\theta_i'),s_{-i}(\widetilde\theta_{-i}))}_{f(\theta_i',\widetilde\theta_{-i})},\theta_i), \]
		so $f$ is DSIC.
	\end{proof}

	Now, let us look at a Bayesian extension, where agents may have probabilistic information about others' types. Recall \hyperref[def: bayesian game]{bayesian games}.\\

	\begin{fdef}[Bayesian implementability]
		A(n indirect) mechanism $\langle M_1,\ldots,M_n,g\rangle$ implements an SCF $f$ in \emph{Bayesian equilibrium} if
		\begin{enumerate}
			\item there exists a message mapping profile $(s_1,\ldots,s_n)$ such that $s_i(\theta_i)$ maximizes the ex-interim utility of agent $i$, that is,
			\[ \E_{\theta_i} \left[ u_i(g(s_i(\theta_i),s_{-i}(\theta_{-i})),\theta_i) \mid \theta_i \right] \ge \E_{\theta_{-i}} \left[ u_i(g(m_i',s_{-i}(\theta_{-i})),\theta_i) \mid \theta_i \right] \]
			for all $m_i',\theta_i,i\in N$, and
			\item $g(s_i(\theta_i),s_{-i}(\theta_{-i})) = f(\theta_i,\theta_{-i})$ for all $i \in N$.
		\end{enumerate}	
		We say that $f$ is Bayesian implementable via $\langle M_1,\ldots,M_n,g\rangle$ under the prior $P$.
	\end{fdef}

	\begin{fprop}
		If an SCF $f$ is dominant strategy implementable, it is Bayesian implementable.
	\end{fprop}

	Similar to \hyperref[def: dsic]{dominant strategy incentive compatibility}, we have the following.

	\begin{fdef}[Bayesian incentive compatibility]
		\label{def: bic}
		A direct mechanism $\langle \Theta_1,\ldots,\Theta_n,f\rangle$ is \emph{Bayesian incentive compatible} (BIC) if
		\begin{equation}
			\label{eqn: dsic}
			\E_{\theta_{-i}} \left[ u_i(f(\theta_i,\widetilde{\theta}_{-i}),\theta_i) \mid \theta_i \right] \ge \E_{\theta_{-i}} \left[ u_i(f(\theta_i',\widetilde{\theta}_{-i}),\theta_i) \mid \theta_i \right].
		\end{equation}
		for all $\theta_i,\theta_i',\widetilde{\theta}_{-i},i$.
	\end{fdef}

	\begin{ftheo}[Revelation principle II]
		If an SCF $f$ is implementable in Bayesian equilibrium, it is BIC.
	\end{ftheo}

	The proof is near-identical to that of the first revelation principle.

\subsection{Arrow's Impossibility Theorem}

	Consider the setting where we have finite sets $A = \{a_1,\ldots,a_m\}$ of alternatives and $N = \{1,\ldots,n\}$ of players. Each player has a preference order $R_i$ over $a$ (a binary relation over $A$) such that
	\begin{enumerate}
		\item Completeness: for every $a,b \in A$, $a R_i b$ or $b R_i a$ or both,
		\item Reflexivity: for all $a \in A$, $a R_i a$, and
		\item Transitivity: for $a,b,c \in A$, if $a R_i b$ and $b R_i c$, then $a R_i c$
	\end{enumerate}
	The set of all such preference orders is denote $\mathcal{R}$. An ordering is linear if for $a,b \in A$, if $aR_i b$ and $bR_i a$, then $a = b$. The set of all such linear orderings is denoted $\mathcal{P}$.\\

	Given any ordering $R_i$, we can decompose it into an \emph{asymmetric part} $P_i$ and \emph{symmetric part} $I_i$.

	\begin{fdef}[Arrovian Social Welfare Function]
		An Arrovian Social Welfare Function (ASWF) is a function $F : \mathcal{R}^n \to \mathcal{R}$.
	\end{fdef}
	That is, given the preference orders of multiple people, we try to consolidate them into a single preference order.\\
	Let $\hat{F}(R)$ and $\overline{F}(R)$ be the asymmetric and symmetric parts of $F(R)$ respectively.

	\begin{fdef}[Pareto]
		An ASWF $F$ is said to be \emph{weak Pareto} if for $a,b \in A$, if $a P_i b$ for all $i \in N$, then $a \hat{F}(R) b$ for all $i \in N$.\\ % he says a P_i b, what does that mean
		An ASWF $F$ is said to be \emph{strong Pareto} if for $a,b \in A$, if $a R_i b$ for all $i \in N$ and for some $j$, $a P_j b$, then $a \hat{F}(R) b$.
	\end{fdef}

	It is not too difficult to see that strong Pareto ASWFs are weak Pareto.\\
	We say that $R_i,R_i'\in\mathcal{R}$ \emph{agree} on $\{a,b\}$ if for agent $i$, $a P_i b$ iff $a P_i' b$, $b P_i a$ iff $b P_i' a$, and $a I_i b$ iff $b I_i a$. We use the shorthand $\restr{R_i}{a,b} = \restr{R_i'}{a,b}$ to denote this. If it holds for every agent $i$, we write $\restr{R}{a,b} = \restr{R'}{a,b}$.

	\begin{fdef}[Independence of irrelevant alternatives]
		An ASFW $F$ is said to satisfy \emph{independence of irrelevant alternatives} (IIA) if for all $a,b \in A$, if $\restr{R}{a,b} = \restr{R'}{a,b}$, then $\restr{F(R)}{a,b} = \restr{F(R')}{a,b}$.
	\end{fdef}
	That is, if everyone prefers one option to another, then the final preference order also prefers this option to the other.\\
	Note that the dictatorship ASWF, defined by $F(R) = R_i$ for some fixed $i$, is both weak Pareto and IIA.

	\begin{ftheo}[Arrow]
		\label{arrow}
		For $|A| \ge 3$, if an ASWF $F$ is weak Pareto and IIA, then it is a dictator.
	\end{ftheo}

	Over the rest of this section, we prove the above.\\
	First, we need some notions of ``decisiveness''.

	\begin{fdef}
		Let $F : \mathcal{R}^n \to \mathcal{R}$ be given, and let $G \subseteq N$ be non-empty.\\
		$G$ is said to be \emph{almost decisive} over $\{a,b\}$ if if $a P_i b$ for all $i \in G$ and $b P_j a$ for all $j \not\in G$, then $a \hat{F}(R) b$. This is denoted $\overline{D}_G(a,b)$. \\
		$G$ is \emph{decisive} over $\{a,b\}$ if if $a P_i b$ for all $i \in G$, then $a \hat{F}(R) b$. This is denoted $D_G(a,b)$.
	\end{fdef}
	If a group is (almost) decisive over all pairs of coordinates, we say that it is (almost) decisive.
	% Clearly, any decisive set is almost-decisive. Also note that 

	The proof goes in two parts.
	\begin{enumerate}
		\item Field expansion: If a group is almost decisive over a pair of alternatives, then it is decisive over all pairs of alternatives.
		\item Group contraction: If a group is decisive, a strict subset of that group is also decisive.
	\end{enumerate}

	\begin{lemma}[Field expansion]
		\label{lem: arrow field expansion}
		Let $F$ be WP and IIA. For all $a \ne b$ and $x \ne y$, and $G \subseteq N, G \ne \emptyset$,
		$\overline{D}_G(a,b)$ implies $D_G(x,y)$.
	\end{lemma}
	% That is, both notions of decisiveness are identical
	\begin{proof}
		There are $6$ cases to consider.
		\begin{enumerate}
			\item Case 1. $x = a$ and $y \ne a,b$. Pick arbitrary $R \in \mathcal{R}^n$ such that $a P_i y$ for all $i \in G$. We wish to show that $a \hat{F}(R) y$.\\
			Construct another preference $R'$ as follows. For $i \in G$, we have $a P'_i b$ and $b P'_i y$, and on $N \setminus G$, $b P'_i a$ and $b P'_i y$, and between $a,y$ we retain the same ordering as in $R_i$.\\
			We ensure that $\restr{R_i'}{a,y} = \restr{R_i}{a,y}$ for all $i \in N$. $\overline{D}_G(a,b)$ implies that $a \hat{F}(R') b$. Weak Pareto over $b,y$ implies that $b \hat{F}(R') y$. So, by transitivity, $a \hat{F}(R') y$. Now, use IIA to conclude that $a \hat{F}(R) y$ as well, completing the proof.
			\item Case 2. $y = b$ and $x \ne a,b$. The idea for this is nearly identical to that in case 1. $R'$ is constructed such that for $i \in G$, $x P_i' a$ and $a P_i' b$, and on $N \setminus G$, $x P_i' a$ and $b P_i' a$, and the ordering of $a,b$ is the same as that in $R$.
			\item Case 3. $x \ne a,b$ and $y \ne a,b$. We have $\overline{D}_G(a,b)$, so $D_G(a,y)$ by case 1, so $\overline{D}_G(a,y)$ by definition, so $D_G(x,y)$ by case 2.
			\item Case 4. $x \ne a,b$ and $y = a$. We have $\overline{D}_G(a,b)$, so $D_G(x,b)$ by case 2, so $\overline{D}_G(x,b)$ by definition, so $D_G(x,a)$ by case 1.
			\item Case 5. $x = b$ and $y \ne a,b$. We have $\overline{D}_G(a,b)$, so $D_G(a,y)$ by case 1, so $\overline{D}_G(a,y)$ by definition, so $D_G(b,y)$ by case 2.
			\item Case 6. $x = a$ and $y = b$. This is trivial.
			\item Case 7. $x = b$ and $y = a$. This similarly follows from previous parts.
		\end{enumerate}
	\end{proof}

	\begin{lemma}[Group contraction]
		\label{lem: arrow group contraction}
		Let $F$ be WP and IIA. Let $G \subseteq N$ with $|G| \ge 2$ be decisive. Then, there exists non-empty $G' \subsetneq G$ which is decisive.
	\end{lemma}
	\begin{proof}
		Let $G_1 \subsetneq G$ and $G_2 = G \setminus G_1$. Let $a,b,c \in R$. Consider an ASWF $R$ which orders $a P_i b P_i c$ for $i \in G_1$, $c P_i a P_i b$ for $i \in G_2$, and $b P_i c P_i a$ for $i \in N \setminus G$. Because $a P_i b$ for all $i \in G$ and $G$ is decisive, $a \hat{F}(R) b$.
		\begin{enumerate}
			\item Case 1. $a \hat{F}(R) c$. Observe that $a P_i c$ for all $i \in G_1$ and $c P_i a$ for $i \not\in G_1$. Consider all $R'$ where this condition holds. By IIA, $a \hat{F}(R') c$. Therefore, $G_1$ is almost decisive over $\{a,c\}$. Therefore, by field expansion $G_1$ is decisive.
			\item Case 2. $c F(R) a$. Recalling that $a \hat{F}(R) b$, we have $c \hat{F}(R) b$. Observe that $c P_i b$ for all $i \in G_2$ and $b P_i c$ for $i \not\in G_2$. Considering all $R'$ where this condition holds again, we get by IIA that $b \hat{F}(R') c$, so $G_2$ is almost decisive over $\{b,c\}$ and by field expansion, $G_2$ is decisive.
		\end{enumerate}
	\end{proof}

	To complete the proof of \nameref{arrow}, note that $N$ is decisive, so by \Cref{lem: arrow group contraction}, there is a singleton decisive set and $F$ is a dictator.

\subsection{Social Choice}

	This means the Arrovian social welfare set up is too demanding. It says that achieving a social ordering in a democratic way is impossible. There are two suggestions to mitigate this:
	\begin{enumerate}
		\item consider a social choice setting, where we output an alternative instead of an ordering.
		\item put restrictions on the agents' preferences.
	\end{enumerate}

	\begin{fdef}
		A \emph{social choice function} is a function $f : \mathcal{P}^n \to A$.
	\end{fdef}
	Note that we assume strict preferences.\\
	Over the enxt few examples, we shall look at various voting rules

	\begin{fex}[Voting]
		\phantom{pain}
		\begin{enumerate}
		\item Scoring rule. Let $s = (s_1,\ldots,s_m)$ be some common score vector. Each voter's $k$th preferred alternative is given a score of $s_k$. The scores are summed over all candidates, and the candidate with the highest score wins. There are various specific cases depending on $s$.
		\begin{itemize}
			\item Plurality. $s = (1,0,0,\ldots,0)$.
			\item Veto. $s = (1,1,\ldots,1,0)$.
			\item Bonds. $s = (m-1,m-2,\ldots,1,0)$.
			\item Harmonic. $s = (1,1/2,\ldots,1/m)$.
			\item $k$-approval. $s = (1,\ldots,1,0,\ldots,0)$ with exactly $k$ $1$s.
		\end{itemize}

		\item Plurality with runoff. This has two phases: in the first, the top $2$ highest scoring candidates are retained and everyone else eliminated, and in the second everyone is asked to vote again. This is practiced in the French presidential election.
		
		\item Maximin. This chooses the candidate with the largest margin of victory wins.

		\item Copeland. Here we view the set of orderings as a collection of votes for pairwise elections, and choose the candidate who wins the most pairwise elections.
		\end{enumerate}
		A \emph{Condorcet} winner is a candidate that beats every other candidate in a pairwise election. It is not guaranteed to exist.\\
		A voting rule that returns a Condorcet winner, if it exists, as the winner, is called \emph{Condorcet consistent}. Clearly, Copeland is Condorcet consistent. It turns out that \emph{no} scoring rule is Condorcet consistent (!), even seemingly logical strategies such as plurality.
	\end{fex}

	\begin{fdef}[Pareto efficiency]
		An alternative $a$ is \emph{Pareto dominated} by $b$ if for all $i \in N$, $b P_i a$.\\
		An SCF $f$ is \emph{Pareto efficient} if for all preference profiles $P$ and $a \in A$, if $a$ is Pareto dominated, then $f(P) \ne a$.
	\end{fdef}

	\begin{fdef}[Unanimity]
		An SCF $f$ is \emph{unanimous} if for a preference profile $P$ with $P_1(1) = P_2(1) = \cdots = P_n(1) = a$ (where $P_i(k)$ is the $k$th preferred alternative of agent $i$), $f(P) = a$.
	\end{fdef}

	\begin{prop}
		The set of Pareto efficient SCFs is strictly contained in the set of unanimous SCFs.
	\end{prop}
	Indeed, every alternative other than $a$ is Pareto dominated by it. Further, this containment is strict, as can be seen by considering an SCF which picks a dominated alternative when not all the top alternatives are identical.

	\begin{fdef}[Ontoness]
		An SCF $f$ is \emph{onto} if for all $a \in A$, there exists $P^* \in \mathcal{P}^n$ such that $f(P^*) = a$.
	\end{fdef}

	\begin{prop}
		The set of unanimous SCFs is contained in the set of onto SCFs.
	\end{prop}
	Indeed, $a$ is chosen by any preference profile which has $a$ at the top spot everywhere.

	\begin{fdef}[Manipulability]
		An SCF $f$ is \emph{manipulable} if there exists $i \in N$ and a profile $P$ such that
		\[ f(P_i',P_{-i}) P_i f(P_i,P_{-i}) \]
		for some $P_i'$.
	\end{fdef}
	That is, by falsely reporting a preference, the agent can arrive at an outcome he prefers more.\\
	Non-manipulability means that on changing the preference you report, the outcome can only become worse.

	\begin{fex}[Manipulability]
		Consider a voting system with three candidates $a,b,c$ (with ties broken in favour of $a > b > c$). \\
		First, suppose we are in the the plurality setting, and the three voters have true preference orders $abc, bac, cba$. If the third voter reports $cba$, then the winner is $a$. If he reports $bca$ on the other hand, the winner is $b$, who is preferred to $a$.\\
		Next, suppose we are in the Copeland setting, and the three voters have true preference orders $abc,bca,cab$. If everyone reports their true preferences, $a$ is the winner. If the second voter instead reports $cba$, then $c$ becomes the Copeland winner. 
	\end{fex}

	\begin{fdef}[Strategyproofness]
		An SCF is said to be \emph{strategy-proof} (SP), \emph{truthful}, or \emph{incentive-compatible} if it is not manipulable by any agent at any profile.
	\end{fdef}

	Let us look at some implications of strategyproofness.

	\begin{fdef}[Dominated set]
		For $a \in A$ and preference $P_i$, the \emph{dominated set} of $a$ at $P_i$ is
		\[ D(a,P_i) = \{ b \in A : a P_i b \}. \]
	\end{fdef}

	\begin{fdef}[Monotonicity]
		An SCF $f$ is \emph{monotone} (MONO) if for any two profiles $P,P'$ with $f(P) = a$ and $D(a,P_i) \subseteq D(a,P_i')$ for all $i \in N$, then $f(P') = a$.
	\end{fdef}
	That is, the relative position of $a$ has weakly improved from $R$ to $R'$.

	\begin{flem}
		An SCF is strategyproof if and only if it is monotone.
	\end{flem}
	% Note the proof technique, which we will see again later.
	\begin{proof}
		Let us look at the forward direction first. Let $f$ be SP and $P,P'$ be two profiles with $f(P) = a$ and $D(a,P_i) \subseteq D(a,P_i')$ for all $i \in N$. For $0 \le k \le n$, let $P^{(k)} = (P_1',P_2',\ldots,P_k',P_{k+1},\ldots,P_n)$ -- note that $P^{(0)} = P$ and $P^{(n)} = P'$. We shall show inductively that $f(P^{(k)}) = a$ for each $0 \le k \le n$. The base case $k = 0$ is trivial.\\
		Suppose that $f(P^{(k-1)}) = a$ but $f(P^{(k)}) = b \ne a$ for some $k \ge 1$.
		Now, note that it is not possible that $b P_k a$ or $a P_k' b$ as this would violate strategyproofness. This means that $a P_k b$ and $b P_k' a$, but this contradicts $D(a,P_k) \subseteq D(a,P_k')$, so we have a contradiction and are done.\\

		Let us now look at the backward direction. Suppose instead that for some profile $P$, $i \in N$, and $P_i'$, $f(P_i',P_{-i}) P_i f(P)$. Set $P' = (P_i',P_{-i}), f(P) = a, f(P') = b$, so $b P_i a$. Construct a preference ordering $P_i''$ with $P_i''(1) = b$ and $P_i''(2) = a$, and let $P'' = (P_i'',P_{-i})$.\\
		We clearly have $D(a,P_j) \subseteq D(a,P_j'')$ for all $j \in N$. Monotonicity implies that $f(P'') = f(P) = a$. On the other hand, $D(b,P'_j) \subseteq D(b,P_j'')$ for all $j \in N$, so by monotonicity $f(P'') = f(P') = b$, resulting in a contradiction.
	\end{proof}
	We shall repeatedly see the above proof strategy.

	\begin{flem}
		If an SCF is monotonic and onto, it is Pareto efficient.
	\end{flem}
	\begin{proof}
		Suppose instead that $f$ is monotonic and onto, but not PE -- let $P$ be a preference profile and $a,b \in A$ such that $b P_i a$ for all $i \in N$, but $f(P) = a$.\\
		Using ontoness, let $P'$ be a profile with $f(P') = b$, and construct a profile $P''$ with $P''_i(1) = b$ and $P''_i(2) = a$ for all $i \in N$. Clearly, $D(b,P') \subseteq D(b,P'')$, so $f(P'') = b$. We also have $D(a,P) \subseteq D(a,P'')$, so $f(P'') = a$, yielding a contradiction.
	\end{proof}

	\begin{fcor}
		Let $f$ be an SCF. The following are equivalent.
		\begin{enumerate}
			\item $f$ is strategyproof and Pareto efficient.
			\item $f$ is strategyproof and unanimous.
			\item $f$ is strategyproof and onto.
		\end{enumerate}
	\end{fcor}

	It turns out that even the above requirement is too strict, however.

	\begin{ftheo}[Gibbard-Satterthwaite Theorem]
		\label{theo: GS}
		% G73 S75
		Suppose $|A| \ge 3$. $f$ is strategyproof and onto if and only if it is dictatorial.
	\end{ftheo}
	The above is untrue when $|A| = 2$ -- plurality with some fixed tie-breaking rule is strategyproof, onto, and non-dictatorial. It may also break down if we place restrictions on the set of alternatives that a voter can report (we assume it to be $\mathcal{P}$).\\
	As long as all ordinal ranks are feasible in the cardinal preference setting, this has an extension to that setting.
	% In general, the result does not hold. We use some specific constructions. If possible, the result holds.

	% The remainder of this section is dedicated to the proof of the Gibbard-Satterthwaite Theorem.\\
	We shall only prove the result for $n = 2$ (so $N = \{1,2\}$). It is possible to then apply induction on the number of agents to prove it for an arbitrary $n$, but we omit this part -- interested readers may consult \cite{gs-theo-sen} for more details.\\

	\begin{proof}
		First of all, we claim that for every preference profile $P$, $f(P) \in \{P_1(1),P_2(1)\}$.\\
		If $P_1(1) = P_2(1)$, unanimity implies that $f(P)$ is this common value.\\
		Suppose that $P_1(1) = a \ne b = P_2(1)$, and $f(P) = c \ne a,b$. Consider a preference $P_1'$ with $P_1'(1) = a, P_1'(2) = b$, and a preference $P_2'$ with $P_2'(1) = b, P_2'(2) = a$. Note that $f(P_1,P_2') \in \{a,b\}$, because every other alternative is Pareto dominated and $f$ is Pareto efficient. Further, $f(P_1,P_2') \ne b$ because this would mean that $f$ is manipulable (by player $2$). Therefore, $f(P_1,P_2') = a$.  Similarly, we get that $f(P_1',P_2) = b$. Now, due to monotonicity (because $f$ is strategyproof), $D(a,P_1) \subseteq D(a,P_1')$, so $f(P_1',P_2') = a$, but similarly $D(b,P_2) \subseteq D(b,P_2')$ so $f(P_1,P_2') = b$, leading to a contradiction and proving the claim.\\

		Now, let $P,P'$ be two profiles with $P_1(1) = a \ne b = P_2(1)$ and $P_1'(1) = c, P_2'(1) = d$. It suffices to show that $f(P') = c$ if $f(P) = a$ and $f(P') = d$ if $f(P) = b$.\\
		If $c = d$, this is trivial by unanimity, so assume $c \ne d$. We shall show that if $f(P) = a$, $f(P') = c$; the other side follows symmetrically.\\
		
		\begin{enumerate}
			\item First, consider the case where $(c,d) = (a,b)$. By the claim, $f(P') \in \{a,b\}$. Suppose instead that $f(P') = b$. Let profile $\hat{P}$ with $\hat{P}_1(1) = a, \hat{P}_1(2) = b, \hat{P}_2(1) = b, \hat{P}_2(2) = a$.\\
			By monotonicity using $P$, we get that $f(\hat{P}) = f(P) = a$, and by monotonicity using $P'$, we get that $f(\hat{P}) = f(P') = b$.

			\item Next, consider the case where $d = b$ but $c \ne a,b$. Again, we have that $f(P') \in \{c,b\}$, and suppose instead that $f(P') = b$. Let $\hat{P}_1$ be a preference order with $\hat{P}_1(1) = c, \hat{P}_1(1) = a$. By case $1$, $f(\hat{P}_1,P_2) = f(P_1',P_2') = b$. Under true preferences $(\hat{P}_1,P_2)$, we see that player $1$ misreporting their preference as $P_1$ would result in a more preferred alternative ($a$ as opposed to $b$), contradicting strategyproofness.

			\item Next, suppose that $c \ne a,b$ and $d \ne b$, and assume that $f(P') = d$. Let $\hat{P}$ be a profile such that $\hat{P}_1(1) = c, \hat{P}_2(1) = b$. By a symmetric version of case 2 applied for $P',\hat{P}$, $f(\hat{P}) = b$. By case 2 applied for $P,\hat{P}$, $f(\hat{P}) = c$, leading to a contradiction.
		\end{enumerate}
		All remaining cases follow similar to case 3 using previously shown cases, so we omit the details.
	\end{proof}

	A reason for a restrictive result like the GS theorem is that the domain of the SCF is too large, a potential manipulator has far too many ways to manipulate.\\
	What this means is that we must restrict the domain of our SCF.

\subsection{Domain restriction}

	Consider the following different definition of strategyproofness.\\
	An SCF $f$ is strategyproof if for all $i \in \N, P_i,P_i' \in \mathcal{P}, P_{-i} \in \mathcal{P}^{n-1}$,
	\[ f(P_i,P_{-i}) P_i f(P_i',P_{-i}) \text{ or } f(P_i,P_{-i}) = f(P_i',P_{-i}). \]
	If we reduce the set of preferences from $\mathcal{P}$ to $\mathcal{S} \subsetneq \mathcal{P}$, a function that is strategyproof on $\mathcal{P}$ continues to remain strategyproof on $\mathcal{S}$. However, we may get some more strategyproof functions.\\

	There are various examples of domain restrictions which lead to interesting non-dictatorial strategyproof SCFs.

	\subsubsection{Single-peaked preferences}
		Consider the example of a room with several people in it, and each person has a preferred temperature $t_i^*$ -- anything above or below this is monotonically disliked more. The agent preferences are ``single-peaked'' in the sense that there is one unique temperature we like the most, and everything else is liked less in a monotonic fashion.\\
		There is a common ordering, the temperature scale here, and each person has a unique preferred point, and on each side there is a monotone decrease. % the two decreases may be different.

		This common ordering is denoted $<$, where the order is any total order (a binary relation is transitive and antisymmetric).

		Why is this a domain restriction? If the ordering is over $\{a,b,c\}$ and the ordering is $a>b>c$, then preferences such as $acb$ are ruled out!

		\begin{fdef}[Single-peaked preference]
			A preference order $P_i$ (that is linear over $A$) of agent $i$ is \emph{single-peaked} with respect to the common order $<$ of the alternatives $A$ if
			\begin{enumerate}
				\item for all $b,c \in A$ with $b < c \le P_i(1)$, $c P_i b$ and
				\item for all $b,c \in A$ with $P_i(1) \le b < c$, $b P_i c$.
			\end{enumerate}
			Denote by $\mathcal{S}$ the set of single-peaked preferences.
		\end{fdef}

		So, under this domain restriction, our SCF is a function $\mathcal{S}^n \to A$.\\
		We also typically take $A$ to be a finite subset of $\R$.\\
		This circumvents the Gibbards-Satterthwaite Theorem as seen by the strategyproof, onto, and non-dictatorial SCF which just outputs the leftmost peak. Clearly, the player with the leftmost peak has no reason to misreport. For any other player, misreporting only changes the outcome if they report something less than the leftmost peak, and they necessarily prefer this less to the current outcome.\\
		A generalization of this is as follows.

		\begin{fdef}[Median voter SCF]
			An SCF $f : \mathcal{S}^n \to A$ is a \emph{median voter SCF} if there exists a multiset $B = \{y_1,\ldots,y_{n-1}\}$ such that $f(P) = \operatorname{median}(B,\operatorname{peaks}(P))$ for all $P \in \mathcal{S}$.
		\end{fdef}

		The points in $B$ are called the peaks of ``phantom voters''. Note that $B$ is fixed for $f$ and does not change with $P$.

		\begin{flem}[Moulin 1980]
			\label{lem: median stratproof}
			Every median voter SCF is strategyproof.
		\end{flem}

		We do not prove this as it is relatively simple -- the proof is similar to what we did when considering the leftmost peak SCF.

		\begin{fprop}
			Let $p_{\min},p_{\max}$ be the leftmost and rightmost peaks of $P$ according to $<$. Then, $f$ is Pareto efficient iff $f(P) \in [p_{\min},p_{\max}]$.
		\end{fprop}

		\begin{proof}
			First, suppose that $f(P) \not\in [p_{\min},p_{\max}]$. Assume that $f(P) < p_{\min}$ without loss of generality. Then, every agent prefers $p_{\min}$ to $f(P)$, so $f(P)$ is dominated and $f$ is not Pareto efficient.\\
			On the other hand, if $f(P) \in [p_{\min},p_{\max}]$, there does not exist any $b$ such that $b P_i f(P)$ for all $i \in N$. Indeed, if $b < f(P)$, it is less preferred by the player with peak $p_{\max}$, and if $b > f(P)$, it is less preferred by the player with peak $p_{\min}$.
		\end{proof}

		Although the proofs differ quite a bit, several results like in the unrestricted setting hold even here.

		\begin{ftheo}
			Let $f : \mathcal{S}^n \to A$. If $f$ is strategyproof, it is monotonic.
		\end{ftheo}
		The proof of this is quite similar to that we did earlier, although we need to argue why the construction in the reverse implication is valid.

		\begin{ftheo}
			\label{theo: single-peaked equivalence}
			Let $f : \mathcal{S}^n \to A$ be strategyproof. The following are equivalent.
			\begin{enumerate}
				\item $f$ is onto.
				\item $f$ is unanimous.
				\item $f$ is Pareto efficient.
			\end{enumerate}
		\end{ftheo}

		\begin{proof}
			We know that Pareto efficiency implies unanimity which implies ontoness. As a result, it suffices to show that ontoness implies Pareto efficiency.. Suppose instead that $f$ is strategyproof and onto but not Pareto efficient. Then, there exist $a,b \in A$ such that $a P_i b$ for all $i \in N$ but $f(P) = b$. Because preferences are single-peaked, there is some alternative $c \in A$ which is a ``neighbour'' of $b$ such that $c P_i b$ for all $i \in N$ (possibly, $c = a$) -- go ``one step'' in the direction of $a$ from $b$.\\
			Using ontoness, let $P'$ such that $f(P') = c$. Consider $P''$ such that $P_i''(1) = c$ and $P_i''(2) = b$ for all $i \in N$. Due to monotonicity from $P$ to $P''$, $f(P'') = b$, and due to monotonicity from $P'$ to $P''$, $f(P'') = c$, leading to a contradiction.
		\end{proof}

		\begin{fdef}
			Given a preference profile $P$ and a permutation $\sigma : N \to N$, define a new preference profile $P^\sigma$ by $(P \circ \sigma^{-1})$ -- the preference of $i$ under $P$ is the preference of $\sigma(i)$ in the new profile.
		\end{fdef}

		\begin{fdef}[Anonymity]
			An SCF $f : \mathcal{S}^n \to A$ is said to be \emph{anonymous} if for every profile $P$ and permutation $\sigma$ of the agents, $f(P^\sigma) = f(P)$.
		\end{fdef}

		Any social choice function that specifically looks at the agent identities is not anonymous. In particular, dictatorial SCFs are not anonymous.\\
		Anonymity seems a sensible property to desire from a good SCF.

		\begin{ftheo}[Moulin 1980]
			An SCF $f$ is strategyproof, onto, and anonymous iff it is a median voter SCF.
		\end{ftheo}
		\begin{proof}
			The backward direction is trivial. We have already seen in \Cref{lem: median stratproof} that $f$ is strategyproof. It is also trivially anonymous because we only look at the set of peaks and do not assign importance to any particular player's peak. For ontoness, given an alternative $a$, we can consider the preference profile that places every player's peak at $a$. Clearly, the outcome is $a$.\\

			Let $f : \mathcal{S}^n \to A$ be strategyproof, anonymous, and onto. Define $P_i^0$ to be agent $i$'s preference with a peak at the leftmost position, and $P_i^1$ as that with a peak at the rightmost position. First, construct the phantom peaks
			\[ y_j = f(P_1^0,P_2^0,\ldots,P_{n-j}^0,P_{n-j+1}^1,\ldots,P_n^1) \]
			for $j = 1,\ldots,n-1$.\\
			
			First, we claim that the $(y_j)$ is non-decreasing.\\
			Note that the profiles we use to define $y_j$ and $y_{j+1}$ differ only at the $(n-j)$th coordinate. Consequently, due to strategyproofness, we must have $y_j P_{n-j}^0 y_{j+1}$ or the two are equal. However, $P_{n-j}^0$ is single-peaked with its peak at $0$, so this just means that $y_j \le y_{j+1}$.\\

			Let $P$ be an arbitrary profile, and $p_i$ be the peaks of $P_i$. We claim that
			\[ f(P) = \operatorname{median}(p_1,\ldots,p_n,y_1,\ldots,y_n). \]
			Due to anonymity, we may assume without loss of generality that $p_1 \le \cdots \le p_n$. Say $a$ is the median we are interested in.\\
			
			First, consider the case where $a = y_j$ for some $j$. By the previous claim and the definition of the median, we must have that $(j-1)$ phantom peaks and $(n-j)$ agent peaks are to the left, and $(n-1-j)$ phantom peaks and $j$ agent peaks to the right of $a$. That is,
			\[ p_1 \le \cdots \le p_{n-j} \le y_j = a \le p_{n-j+1} \le \cdots \le p_n. \]
			By definition,
			\[ y_j = f(P_1^0,P_2^0,\ldots,P_{n-j}^0,P_{n-j+1}^1,\ldots,P_n^1). \]
			Let
			\[ b = f(P_1,,P_2^0,\ldots,P_{n-j}^0,P_{n-j+1}^1,\ldots,P_n^1). \]
			Due to strategyproofness, $y_j P_1^0 b$, so $y_j \le b$. By strategyproofness again, $b P_1 y_j$. Further, $p_1 \le y_j$, so this means that $b \le y_j$. Therefore, $b = y_j$! We can then repeat this argument for the first $(n-j)$ agents to get that
			\[ f(P_1,\ldots,P_{n-j},P_{n-j+1}^1,\ldots,P_n^1) = y_j. \]
			After this, we replace preferences from the right hand-side, to finally get that $y_j = f(P)$.\\

			Next, suppose that $a = p_j$ for some $j$. We prove this in the case where there are two players, and the general case is a (slightly non-trivial) extension of this argument.\\
			Let $a = P_1(1)$ and $b = P_2(1)$. 

			Let $P'$ such that $P_i(1) = P_i'(1)$ for all $i \in N$. We claim that $f(P) = f(P')$. That is, as long as the peaks stay the same, the preferences stay the same.\\
			Set $f(P) = x$ and $f(P_1',P_2) = y$. Because $f$ is strategyproof, $x P_1 y$ and $y P_1' x$. If $x$ and $y$ are on the same side of the peak $a$, then they must be the same.\\
			Assume without loss of generality that $x < a < y$ and $a < b$. Recall that $f$ is Pareto efficient by \Cref{theo: single-peaked equivalence}, so $f(P) \in [a,b]$. However, we have $f(P) = x < a$. We repeat this same argument to go from $(P_1',P_2)$ to $(P_1',P_2')$, thus proving the claim.\\
			
			Now, set $y_1$ to be the phantom peak obtained from earlier. By our assumption, the median is an agent peak, so say it is equal to $a$. This means that $b < a < y_1$ or $y_1 < a < b$. Assume for contradiction that $f(P) = c \ne a$.\\
			In the situation where $b < a < y_1$, we have by Pareto efficiency that $c < a$. Construct $P_1'$ such that $P_1'(1) = a$ and $y_1 P_1' c$ (this is possible because $c$ and $y_1$ are on different sides of the peak). Conider the profile $(P_1^1,P_2)$. We have $b < y_1 \le P_1^1(1)$ so the median of the three is $y_1$, a phantom peak, and we can use case 1 to conclude that $f(P_1^1,P_2) = y_1$. However, $y_1 P_1' c$ by construction, contradicting strategyproofness since $f(P_1',P_2) = c$.\\
			The case where $y_1 < a < b$ is very similar, except that we consider $P_1^0$ instead of $P_1^1$.
		\end{proof}

		For a complete proof of the above result (with $n$ players), the reader may consult \cite{moulin-singlepeak}.

	\subsubsection{Task allocation domain}

		The next domain restriction we shall look at is called task allocation domain. In this, we have a unit amount of task to be shared among $n$ agents, and agent $i$ gets a share $s_i \in [0,1]$ such that $\sum_{i \in N} s_i = 1$.\\
		Similar to single-peaked preferences, every agent has a preferred shared of work. 

		\begin{fex}
			Each task may have a reward, say a $w$ amount of wages per unit time. If agent $i$ works for time $t_i$, then they earn an amount of $wt_i$. This task also has costs (say physical tiredness) depending on the agent equal to $c_it_i^2$. The net payoff is then $wt_i - c_it_i^2$, which is maximized at $t_i^* = w/(2c_i)$.\\
			This is single-peaked over the \emph{share of the task}, and not the alternatives. \\
			If the alternatives are $(0.2,0.4,0.4)$ and $(0.2,0.6,0.2)$, player $1$ is indifferent. Note that if the preferences are single-peaked for all, we cannot have a single common order over the alternatives.
		\end{fex}

		Denote the domain of task allocation by $T$ (a single-peaked function over the task share), so the SCF is $f : T^n \to A$. For a preference profile $P \in T^n$, we have $(f(P))_i \in [0,1]$ for each $i$ and $\sum_{i \in N} (f(P))_i = 1$.\\
		Suppose that player $i$ has peak $p_i$ over the share.

		\begin{fdef}
			An SCF $f : T^n \to A$ is \emph{Pareto efficient} if there exists no other share of the task that is weakly preferred by all agents and strictly preferred by at least one. That is, there exists no $a \in A$ such that $a R_i f(P)$ for all $i \in N$ and $a P_j f(P)$ for some $j$.
		\end{fdef}

		\begin{flem}
			\label{lem: task allocation pe}
			An SCF $f : T^n \to A$ is Pareto efficient iff
			\begin{enumerate}
				\item for any preference profile $P$ with $\sum_{i \in N} p_i = 1$, $f_i(P) = p_i$ for all $i \in N$.
				\item for any preference profile $P$ with $\sum_{i \in N} p_i > 1$, $f_i(P) \le p_i$ for all $i \in N$.
				\item for any preference profile $P$ with $\sum_{i \in N} p_i = 1$, $f_i(P) \ge p_i$ for all $i \in N$.
			\end{enumerate}
		\end{flem}
		\begin{proof}
			First of all, if $\sum_{i \in N} p_i = 1$, then there is no problem and we must allocate tasks according to the peaks of the agents. This is the unique Pareto efficient SCF.\\

			If $\sum_{i \in N} p_i > 1$, for any SCF $f$, there exists some $k \in N$ such that $f_k(P) < p_k$.\\
			If $f$ is Pareto efficient, can there exist an agent $j$ such that $f_j(P) > p_j$? No, because if this were the case, we would increase $k$'s share of the task and reduce $j$'s share of the task, to make both players strictly better off.\\
			Consequently, for all $j \in N$, $f_j(P) \le p_j$.

			Finally, an identical argument yields that if $\sum_{i \in N} p_i < 1$, $f_j(P) \ge P_j$ for all $j \in N$.
		\end{proof}


		\begin{fdef}[Anonymity]
			For an anonymous SCF $f : T^n \to A$,
			\[ f_{\sigma(j)}(P^\sigma) = f_j(P). \]
		\end{fdef}
		Note that with the permuting of the agent shares, the shares are permuted as well!\\

		Let us look at a couple of candidate SCFs.
		\begin{enumerate}
			\item Serial dictatorship. A predetermined sequence of agents if xied. Each agent is given either their peak or a leftover share. If $\sum p_i < 1$, the last agent is given the leftover share. This is Pareto efficient and strategyproof but not anonymous. It is also quite unfair for later agents.
			\item Proportional. Every player is assigned a share that is some constant multiplied by their peaks. That is, if $\sum_{i \in N} p_i = s$, we assign a share of $p_i/s$ to each player.\\
			This is not strategyproof. For example, if the peaks are $0.2,0.3,0.1$, we have $s = 0.6$ and player $1$ gets $1/3$. If they report $0.1,0.3,0.1$ instead however, player $1$ gets $0.2$.
		\end{enumerate}

		We shall next describe a rule that is Pareto efficient, anonymous, and strategyproof, known as the \emph{uniform rule}.\\
		Suppose that $\sum_{i \in N} p_i < 1$. We begin with everyone's allocation being $1$. We keep reducing each person's allocation uniformly. Whenever we hit someone's peak, we stop reducing that agent's share. We keepm reducing until $\sum f_i = 1$.\\
		When $\sum_{i \in N} p_i > 1$, we instead start with everyone's allocation being $0$ and increase it gradually.

		\begin{fdef}
			The uniform allocation rule $f^u$ is described as follows.
			\begin{enumerate}
				\item If $\sum_i p_i = 1$, $f_i^u(P) = p_i$.
				\item If $\sum_{i \in N} < 1$, set $\mu(P)$ as the largest number that satisfies $\sum_{i \in N} \max\{p_i,\mu\} = 1$ and allocate $f_i^u(P) = \max\{p_i,\mu(P)\}$.
				\item If $\sum_{i \in N} > 1$, set $\lambda(P)$ as the largest number that satisfies $\sum_{i \in N} \min\{p_i,\lambda\} = 1$ and allocate $f_i^u(P) = \min\{p_i,\lambda(P)\}$.
			\end{enumerate}
		\end{fdef}

		\begin{flem}
			The uniform rule SCF is anonymous, Pareto efficient, and strategyproof.
		\end{flem}
		\begin{proof}
			It is quite easy to see anonymity since we only look at the agents' peaks and not the agents themselves.\\
			Pareto efficiency follows trivially by \Cref{lem: task allocation pe}.\\
			Strategyproofness is evident when $\sum p_i = 1$.\\
			Suppose now that $\sum_i p_i < 1$, so $f_i^u(P) \ge p_i$. Any beneficial manipulation must be done by agents with $f_i^u(P) > p_i$. That is, $\mu(P) > p_i$. the allocation stopped before ``reaching'' $p_i$. The only way this allocation can change is by reporting $p_i' > \mu(P) > p_i$, but this is a worse allocation for $i$ than $\mu(P)$. The proof when $\sum p_i > 1$, the proof is identical
		\end{proof}

		\begin{ftheo}[Sprumont]
			An SCF $f : T^n \to A$ is strategyproof, Pareto efficient, and strategyproof iff it is the uniform rule.
		\end{ftheo}
		We do not describe the proof of the above, and refer the reader to \cite{sprumont-uniform-rule}.

	\subsubsection{Mechanism design with transfers}

		In this case, the utility can be transferred and is thought of something like money. A social choice function here is a function $F : \Theta \to X$, where an outcome $x \in X$ has two components, an allocation $a \in A$ and a payment vector $\pi \in \R^n$.

		\begin{fex}
			\label{ex: payment irl examples}
			One real-life example of this is a public decision of building a bridge or a park, so $A$ is $\{\text{bridge},\text{park}\}$.\\
			We can think of the allocation of a divisible good (a ``shared spectrum''), where $a \in [0,1]^n$ and $\sum a_i = 1$. We can also think of an indivisible version of this, where $a \in \{0,1\}^n$ and $\sum a_i \le 1$. Alternatively, we can have a partition of indivisible objects, so we have an overall set of objects $S$ and
			\[ A = \{ (A_1,\ldots,A_n) : A_i \subseteq S\text{ and }A_i \cap A_j = \emptyset \text{ for all distinct $i,j \in N$} \}. \]
		\end{fex}

		Here, the type of an agent is $\theta_i \in \Theta_i$, the private information of $i$. An agent's benefit from an allocation is defined using a valuation function $v_i : A \times \Theta_i \to \R$.\\
		In the previous example, if we look at the benefit to the environment for example, the valuation of a bridge would be lower than that for a park.\\

		The utility of a player $i$ when their type is $\theta_i$ and the outcome is $x = (a,\underline{\pi})$ is given by
		\[ u_i( (a,\pi) , \theta_i ) = v_i(a,\theta_i) - \pi_i. \]
		Note that this is always linear in the payment, but can be non-linear in the allocation component. Due to this, we call this the \emph{quasilinear domain}. \\
		If we have two alternatives $(a,\pi^{(1)})$ and $(a,\pi^{(2)})$, agent $i$ always prefers that with the lower $\pi_i$! This is the simple restriction intrinsic to this, section, which opens up opportunity for numerous interesting SCFs.\\

		We split the function $F$ into the allocation part and the payment parts, $f : \Theta \to A$ and $p_i : \Theta \to \R$. Here, $\pi_i = p_i(\theta)$. The tuple of $p_i$ is denoted $p$.

		\begin{fex}[Allocation rules]
			\label{ex: payment alloc rules}
			A couple of examples of allocation rules are as follows.
			\begin{enumerate}
				\item One uninteresting allocation rule is the \emph{constant rule} where $f^c(\theta) = a$ for all $\theta \in \Theta$.

				\item A slightly more inspired rule is the \emph{dictatorial rule}, where
				\[ f^D(\theta) = \argmax_{a \in A} v_d(a,\theta_d) \]
				for all $\theta \in \Theta$ for some fixed $d \in N$.
				
				\item The \emph{allocatively efficient} or \emph{utilitarian} rule is
				\[ f^{\text{AE}}(\theta) = \argmax_{a \in A} \sum_{i \in N} v_i(a,\theta_i). \]
				Allocative efficiency is \emph{not} the same as Pareto efficiency, which is defined for the outcome which also considers the payment.

				\item The \emph{affine maximizer} rule is defined by
				\[ f^{\text{AM}}(\theta) = \argmax_{a \in A} \left( \sum_{i \in N} \lambda_i v_i(a,\theta_i) + \kappa(a) \right), \]
				where each $\lambda_i$ is chosen to be non-negative and at least one is nonzero. Note that all three rules before this are specific cases of the affine maximizer rule.

				\item The \emph{max-min} or \emph{egalitarian rule} has
				\[ f^\text{MM}(\theta) = \argmax_{a \in A} \min_{i \in N} v_i(a,\theta_i). \]
			\end{enumerate}
		\end{fex}

		\begin{fex}[Payment rules]
			Three examples of rules that our payment function $p$ might satisfy are
			\begin{enumerate}
				\item \emph{No deficit}. Here, $\sum_{i \in N} p_i(\theta) \ge 0$ for all $\theta \in \Theta$.
				\item \emph{No subsidy}. Here, $p_i(\theta) \ge 0$ for all $\theta \in \Theta, i \in N$. Clearly, a no subsidy payment rule is a no deficit payment rule.
				\item \emph{Budget balanced}. Here, $\sum_i p_i(\theta) = 0$ for all $\theta \in \Theta$. 
			\end{enumerate}
		\end{fex}

		Recall incentive compatibility. This definition can be mildly altered in the mechanism design with payment scenario as follows.

		\begin{fdef}[Dominant strategy incentive compatibility]
			\label{def: payment dsic}
			A mechanism $(f,p)$ is \emph{dominant strategy incentive compatible} (DSIC) if for all $i \in N, \theta_{-i} \in \Theta_{-i}, \theta_i,\widetilde{\theta}_i \in \Theta_i$, if we set $\theta = (\theta_i,\theta_{-i})$ and $\widetilde{\theta} = (\widetilde{\theta}_i,\theta_{-i})$,
			\[ v_i(f(\theta),\theta_i) - p_i(\theta) \ge v_i(f(\widetilde{\theta}),\theta_i) - p_i(\widetilde{\theta}). \]
		\end{fdef}

		DSIC means that telling the truth is a weakly dominating strategy equilibrium.

		Our goal is that the payment rule implements $f$ in dominant strategies. In the quasilinear domain, we are often more interested in the allocation rule than the whole SCF (which also includes the payment).
		
		\begin{fex}
			Suppose that there are two players $N = \{1,2\}$ and $\Theta_1 = \Theta_2 = \{\theta^H, \theta^L\}$ and $f : \Theta_1 \times \Theta_2 \to A$. For $(f,p)$ to be DSIC,
			\begin{align*}
				v_1( f(\theta^H, \theta_2) , \theta^H ) - p(\theta^H,\theta_2) &\ge v_1(f(\theta^L,\theta_2) , \theta^H) - p_i(\theta^L,\theta_2) \\
				v_1( f(\theta^L, \theta_2) , \theta^L ) - p(\theta^L,\theta_2) &\ge v_1(f(\theta^H,\theta_2) , \theta^L) - p_i(\theta^H,\theta_2)
			\end{align*}
			and similar inequalities for the second player. 
		\end{fex}

		Now, suppose that $(f,p)$ is incentive compatible. Consider another payment
		\[ q_i(\theta) = p_i(\theta) + h_i(\theta_{-i}) \]
		for all $\theta,i \in N$. Then, note that $(f,q)$ is incentive compatible as well! Therefore, if we find a single payment that implements an allocation rule, we get an entire family of payments that implement the allocation rule. A converse question we can ask is: when do payments that implement $f$ differ only by a factor of $h_i(\theta_{-i})$?

		\begin{fex}
			Suppose the allocation is the same for two type profiles $\theta,\widetilde{\theta} = (\widetilde{\theta_i},\theta_{-i})$ and $f(\theta) = f(\widetilde{\theta}) = a$. if $p$ implements $f$, then \Cref{def: payment dsic} immediately yields that $p_i(\theta) = p_i(\widetilde{\theta})$.
		\end{fex}

		Let us now move to Pareto efficiency in the quasilinear domain.

		\begin{fdef}
			A mechanism $(f,p)$ is said to be \emph{Pareto optimal} if at every type profile $\theta \in \Theta$, there exists no allocation $b \ne f(\theta)$ and payments $(\pi_1,\ldots,\pi_n)$ with $\sum_i \pi_i \ge \sum_i p_i(\theta)$ such that
			\[ v_i(b,\theta_i) - \pi_i \ge v_i(f(\theta),\theta_i) - p_i(\theta) \]
			for all $i \in N$, with the inequality being strict for some $i$.
		\end{fdef}

		The reason for having $\sum_i \pi_i \ge \sum_i p_i(\theta)$ is that otherwise, we can always put an excessive subsidy to every agent and make everyone better off.\\
		Recall allocative efficiency from \Cref{ex: payment alloc rules}.

		\begin{ftheo}
			A mechanism $(f,p)$ is Pareto optimal if and only if it is allocatively efficient.
		\end{ftheo}
		\begin{proof}
			\phantom{pain}
			\begin{itemize}
				\item Suppose that $(f,p)$ is not allocatively efficient. Then, there exists $b \ne f(\theta)$ such that
				\[ \sum_i v_i(b,\theta_i) > \sum_{i \in N} v_i(f(\theta),\theta_i) \]
				for some $\theta$. Let $\delta > 0$ be the difference between the two as above. Consider the payment
				\[ \pi_i = v_i(b,\theta_i) - v_i(f(\theta),\theta_i) + p_i(\theta) - (\delta/n). \]
				Then,
				\[ \left( v_i(b,\theta_i) - \pi_i \right) - \left(v_i(f(\theta),\theta_i) - p_i(\theta)\right) = (\delta/n) > 0 \]
				and $\sum_i \pi_i = \sum_i p_i(\theta)$, show that $(f,p)$ is not Pareto optimal.

				\item Suppose that $(f,p)$ is not Pareto optimal. Let $\theta,\pi,b \ne f(\theta),\pi$ such that
				\[ \sum_i \pi_i \ge \sum_i p_i(\theta) \]
				and
				\[ v_i(b,\theta_i) - \pi_i \ge v_i(f(\theta),\theta_i) - p_i(\theta) \]
				for all $i \in N$, with the inequality being strict for some $j$.\\
				Summing the second inequality over $i$,
				\begin{align*}
					\sum_i v_i(b,\theta_i) - \pi_i &> \sum_i v_i(f(\theta),\theta_i) - p_i(\theta) \\
					\sum_i v_i(b,\theta_i) - \sum_i v_i(f(\theta),\theta_i) &> \sum_i \pi_i - \sum_i p_i(\theta) \ge 0,  
				\end{align*}
				showing that $(f,p)$ is not allocatively efficient.
			\end{itemize}
		\end{proof}

		So, for any Pareto optimal mechanism $(f^\text{eff},p)$, we have
		\[ f^\text{eff}(\theta) \in \argmax_{a \in A} \sum_{i \in N} v_i(a,\theta_i). \]
		This seems to suggest that any sensible mechanism has this (more or less) fixed allocation part. We must now come up with a sensible payment part to make it DSIC.
		
		\begin{fdef}[Groves payment]
			Given a Pareto optimal function $f$, consider the \emph{Groves payment} defined for each $i$ by
			\[ p_i^G(\theta) = h_i(\theta_{-i}) - \sum_{j \ne i} v_j(f^\text{eff}(\theta),\theta_j) \]
			where $h_i : \Theta_{-i} \to \R$ is any arbitrary function.
		\end{fdef}

		Perhaps surprisingly, this is a truthful mechanism!

		\begin{ftheo}
			Any Groves mechanism is DSIC.
		\end{ftheo}
		\begin{proof}
			Arbitrarily choose player $i$, $\theta = (\theta_i,\theta_{-i})$, and $\widetilde{\theta} = (\widetilde{\theta}_i,\theta_{-i})$, and set $a = f^\text{eff}(\theta)$ and $b = f^\text{eff}(\widetilde{\theta})$. By definition,
			\[ v_i(a,\theta_i) + \sum_{j \ne i} v_j(a,\theta_j) \ge v_i(b,\theta_i) + \sum_{j \ne i} v_j(b,\theta_j). \]
			The utility of player $i$ when they report $\theta_i$ is
			\begin{align*}
				v_i(a,\theta_i) - p_i(\theta) &= v_i(a,\theta_i) - h_i(\theta_{-i}) + \sum_{j \ne i} v_j(a,\theta_j) \\
				&\ge v_i(b,\theta_i) - h_i(\theta_{-i}) + \sum_{j \ne i} v_j(b,\theta_j) \\
				&= v_i(b,\theta_i) - p_i(\widetilde{\theta}),
			\end{align*}
			proving the result.
		\end{proof}