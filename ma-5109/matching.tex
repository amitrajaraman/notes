\section{Matching Theory}

\begin{fdef}
	Given a graph $G$, a \textbf{matching} $\mathcal{M}$ in $G$ is a collection of pairwise disjoint edges in $G$ (no two of the edges have a common vertex).
\end{fdef}

For example, $\{\{1,6\},\{2,5\},\{3,4\}\}$ is a matching in $K_6$.

\begin{fdef}
	Given a graph $G$, the \textbf{matching number} $\nu(G)$ of $G$ is the size of a maximum matching in $G$.
\end{fdef}

Given a graph, how do we compute a maximum matching, or simpler yet, $\nu(G)$?

	\subsection{The Bipartite Setting}

		For this section, suppose that $G = (X,Y,E)$ is bipartite, where all edges in $E$ are between $X$ and $Y$. Assume $|X| \le |Y|$.\\
		It is clear that $\nu(G) \le |X|$.\\

		The question is: under what conditions on $G$ is $\nu(G) = |X|$?\\
		This (the bipartite scenario) is sometimes referred to as a \emph{system of distinct representatives} (SDR). That is, $G$ has an SDR if $\nu(G) = |X|$.\\

		\subsubsection{Hall's Marriage Theorem}

			An obvious necessary condition is that given any $S\subseteq X$,
			\[ |\Gamma(S)| \ge |S|. \]
			Otherwise, there cannot exist a matching since two vertices in $S$ would be forced to map to the same element in $Y$.\\
			This is known as \emph{Hall's condition}.\\
			It in fact turns out that Hall's condition is sufficient for the existence of a matching too!

			\begin{ftheo}[Hall's Marriage Theorem]
				Suppose $G=(X,Y,E)$ is bipartite with $|X|\le |Y|$. Then $\nu(G) = |X|$ if and only if it satisfies Hall's condition.
			\end{ftheo}
			Much like Tur\'{a}n's theorem, this has a large number of proofs.
			\begin{proof}[Proof 1 of Hall's Marriage Theorem]
				We begin with a proof by induction over $|X|$. If $|X|=1$, the theorem obviously holds.\\
				Make the stronger assumption that for all $S\subseteq X$ of size $|X|-1$, $|\Gamma(S)| > |S|$, and $|\Gamma(X)| \ge |X|$. Pick $x\in X$ and pair it with an arbitrary neighbour $y\in Y$. Using the inductive hypothesis on the subgraph induced on $(X\setminus\{x\}) \cup (Y\setminus\{y\})$, we get a matching on $G$.\\
				Now, let $S\subseteq X$ with $|\Gamma(S)|=|S|=|X|-1$. Using the inductive hypothesis on the subgraph induced on $S\cup\Gamma(S)$, together with the edge from the (single) element in $X\setminus S$ to any element in $\Gamma(X)\setminus\Gamma(S)$, we get a matching on $G$.
			\end{proof}
			An alternate way to prove this is by doing the first part of the proof with all non-empty $S\subseteq X$ (instead of only those of size $|X|-1$). In the case where we have some non-empty $S\subseteq X$ with $|\Gamma(S)|=|S|$, we can use the inductive hypothesis twice to get two matchings $\mathcal{M}_1$ and $\mathcal{M}_2$ on the subgraphs induced by $S \cup \Gamma(S)$ and $(X\setminus S) \cup (Y\setminus\Gamma(S))$, then take the union of the two matchings to get a matching $\mathcal{M}$ on the original graph $G$.\\

			A nice consequence of the above proof is that it allows us to extend Hall's Theorem to an infinite setting as well.

			\begin{definition}
				Given a matching $\mathcal{M}$ on a graph $G=(V,E)$, call a $v\in V$ \textbf{unsaturated} if no edge of $\mathcal{M}$ is incident on $v$.
			\end{definition}

			For a matching $\mathcal{M}$, $x\in X$, $y\in Y$ such that $x,y$ are unsaturated (with respect to $\mathcal{M}$), a path $P$ from $x$ to $y$ is called $\mathcal{M}$-\textbf{augmenting} if every alternate edge in it is a $\mathcal{M}$-edge.\\
			Observe that if $\mathcal{M}$ admits an augmenting path, then $\mathcal{M}$ is not maximal. Indeed, we can `flip' the edges in the path to show this. That is, given an augmenting path $\mathcal{P}$, where every $y_ix_i$ is in $\mathcal{M}$, it is not too difficult to show that $\mathcal{M} \triangle \mathcal{P}$ is a matching that has strictly more edges.\\

			\begin{proof}[Proof 2 of Hall's Marriage Theorem]
				Let $\mathcal{M}$ be a maximum matching of a bipartite graph $G=(X,Y,E)$ that satisfies Hall's condition. Suppose there exists $x_0 \in X$ such that $x_0$ is unsaturated by $\mathcal{M}$. Let $y_1$ be a neighbour of $x_0$ (such a $y_1$ exists by Hall's condition).\\
				If $y_1$ is unsaturated by $\mathcal{M}$, then $x_0y_1$ is a $\mathcal{M}$-augmenting path, contradicting its maximality. So, suppose $x_1y_1 \in \mathcal{M}$.\\
				In general, if we have $y_1,\ldots,y_r,x_1,\ldots,x_r$, we can pick $y_{r+1}\in \Gamma(\{x_0,\ldots,x_r\})$ (distinct from all the $y_i$ for $1\le i\le r$).\\
				If $y_{r+1}$ is unsaturated, we have a $\mathcal{M}$-augmenting path from $x_0$ to $y_{r+1}$, contradicting the maximality of $\mathcal{M}$.\\
				If it is not, we can jump back to the $x_{r+1}\in X$ (distinct from the $x_i$ for $1\le i\le r$) such that $y_{r+1}x_{r+1} \in E$, then continue the process. This must terminate at some point since the number of vertices in $Y$ incident on some element of $\mathcal{M}$ is at most $|X\setminus\{x_0\}|< |Y|$, completing the proof.
			\end{proof}

		\subsubsection{Some applications}

			Next, let us look at a few applications of Hall's Theorem.

			\begin{fdef}[Perfect Matching]
				A matching $\mathcal{M}$ in a graph $G=(V,E)$ is said to be a \textbf{perfect matching} if $|\mathcal{M}| = |V|/2$, that is, every vertex in $V$ is saturated by $\mathcal{M}$.
			\end{fdef}

			\begin{ftheo}
				If a bipartite graph $G=(X,Y,E)$ is $d$($>0$)-regular, it has a perfect matching.
			\end{ftheo}
			\begin{proof}
				It suffices to check that Hall's condition holds. Let $S\subseteq X$. We clearly have $e(S,\Gamma(S))=d|S|$. However, the total number of edges coming into $\Gamma(S)$ must include all the edges coming from $S$, that is, $S\subseteq\Gamma(\Gamma(S))$. So,
				\begin{align*}
					d|\Gamma(S)| &= e(\Gamma(S),\Gamma(\Gamma(S))) \\
						&\ge e(\Gamma(S),S) \\
						&= d|S|,
				\end{align*}
				completing the proof.
			\end{proof}

			For the next result, consider the following definition.

			\begin{fdef}
				A matrix $A\in\R^{n\times n}$ is said to be \textbf{doubly stochastic}\footnotemark\ if for all $i,j$,
				\[ 0\le a_{ij} \le 1 \text{ and } \sum_{k} a_{ik} = \sum_{k} a_{kj} = 1. \]
			\end{fdef}
			\footnotetext{These are interesting to study since they arise as the transition matrices of a certain class of discrete Markov chains. The stationary distribution of a discrete Markov chain with a doubly stochastic transition matrix is the uniform distribution.}

			It is not too difficult to see that any permutation matrix is doubly stochastic.\\
			Suppose $A_1,A_2$ are doubly stochastic and $0\le\lambda\le 1$. Then observe that $\lambda A_1 + (1-\lambda)A_2$ is doubly stochastic too (Why?).\\
			As a result, a convex combination of doubly stochastic matrices is doubly stochastic.

			\begin{ftheo}[Birkhoff-von Neumann Theorem]
				A matrix is doubly stochastic iff it is a convex combination of permutation matrices.
			\end{ftheo}
			\begin{proof}
				We want to show that if $A$ is doubly stochastic, then $A = \sum_{i=1}^k \lambda_i P_i$, where the $P_i$ are permutation matrices, $\sum_i \lambda_i = 1$, and $\lambda_i \ge 0$.\\
				The idea is something like performing induction on $k$. If $A$ is doubly stochastic, $P$ is a permutation matrix, and $0 < \lambda < 1$ such that every entry of $B = A - \lambda P$ is non-negative, then every row sum and column sum of $B$ is equal to $1-\lambda$.
				So, if we can find such $\lambda$ and $P$ with $\lambda$ chosen `maximally' (in the sense that if we increase it any more, some entry will become negative), we can ensure that $B$ has more zero elements than $A$. This then allows us to induct on the number of non-zero entries in $A$.\\
				The base case is when $A$ has $n$ non-zero entries and in this case, $A$ is equal to a permutation matrix (Why?). \\
				Given the earlier claim about the existence of $\lambda$ and $P$, the result follows-near directly on applying the inductive hypothesis to $(1/(1-\lambda)) B$.\\
				To prove the claim, consider the bipartite graph $G= (X,Y,E)$ with $X$ and $Y$ being the rows and columns of $B$ respectively, and $xy\in E(G)$ iff $B_{xy} > 0$. If the graph has a perfect matching, then there exist $\lambda,P$ of the required form -- set $P$ as the permutation matrix that has $1$s at the edges corresponding to the matching, and let $\lambda$ be equal to
				\[ \min\{ b_{xy} : xy \text{ is an edge in the matching} \}. \]
				To show that the graph admits a perfect matching, we check Hall's condition. For all $S\subseteq X$, we want to show that $|N(S)| \ge |S|$. Now, by definition, the submatrix corresponding to the rows indexed by $S$ and columns indexed by $Y\setminus S$ is then the zero submatrix. Using the row sum condition,
				\[ \sum_{\substack{x\in S \\ y \in N(s )}} b_{xy} = \alpha |S|. \]
				Since $B$ is non-negative, this sum is at most
				\[ \sum_{\substack{x\in X \\ y\in N(S)} b_{xy}} = \alpha |N(S)| \]
				by the column sum condition. The claim follows.
			\end{proof}

			Now, let us look for a moment at matchings in graphs in general (that need not be bipartite).

			\begin{ftheo}
				A matching $\mathcal{M}$ in a graph $G$ is maximum iff it admits no $\mathcal{M}$-augmenting path.
			\end{ftheo}
			\begin{proof}
				The proof we gave earlier to show that admitting a $\mathcal{M}$-augmenting implies non-maximality works out even in the non-bipartite scenario.\\
				For the converse, suppose that $\mathcal{M}$ is a matching that admits no $\mathcal{M}$-augmenting path, and that $\mathcal{N}$ is a matching with $|\mathcal{N}| > |\mathcal{M}|$. Consider the subgraph $H$ of $G$ that retains only those edges in $\mathcal{M}$ or $\mathcal{N}$, but not both. Note that for any vertex of $G$, $d_H(v) \le 2$.\\
				It is not too difficult to show that $H$ is a disjoint union of cycles and paths. Since the $\mathcal{M}$ edges and $\mathcal{N}$ edges are individually pairwise disjoint, there cannot be an odd cycle in $H$. Since $\mathcal{N} > \mathcal{M}$, there must be a path that contains more $\mathcal{N}$ edges than $\mathcal{M}$ edges, and this is just an augmenting path(!), thus completing the proof.
			\end{proof}

			The above proposition allows us to find maximum matchings using a polynomial time algorithm.\\
			We give such an algorithm in the bipartite scenario.

			\begin{fdef}
				A \textbf{directed graph} is a pair $D=(V,E)$, where $V$ is the vertex set of $D$, and $E\subseteq V\times V$ is the set of \emph{directed edges} or \emph{arcs}. An edge $e = (u,v)$ is said to be directed from $u$ to $v$.
			\end{fdef}

			We often abuse notation and denote an edge $(u,v)$ by $\vv{uv}$ or $uv$.\\
			We can define several things here similar to in ordinary simple graphs. For example, a \emph{directed path} is a sequence $v_1,\ldots,v_n$ of vertices such that $(v_i, v_{i+1})$ is an edge for all valid $i$.

			\begin{ftheo}
				Suppose $G = (X,Y,E)$ is bipartite with $|X| \le |Y|$. There exists a polynomial time algorithm to find a maximum matching in $G$.
			\end{ftheo}
			\begin{proof}
				The idea of the proof is to construct augmenting paths. Given an augmenting path $P$ for a matching $\mathcal{M}$, $\mathcal{M}\triangle P$ is a matching with strictly more edges. If we begin with an arbitrary matching and perform this operation repeatedly, we must terminate within $|X|/2$ iterations.\\
				Let $\mathcal{M}$ be a matching. Our objective is to either produce an augmenting path, or show that there exists no $\mathcal{M}$-augmenting path. Let $X_\mathcal{M}$ and $Y_\mathcal{M}$ be the vertices in $X$ and $Y$ respectively saturated by $\mathcal{M}$, and let $X_U = X \setminus X_\mathcal{M}$ and $Y_U = Y \setminus Y_\mathcal{M}$. Notice that an augmenting path (if it exists) is uniquely determined by its sequence in $X_\mathcal{M}$ (since the edges from $X_\mathcal{M}$ to $Y_\mathcal{M}$ are fixed).\\
				NOw, define the directed graph $D_\mathcal{M} = (X,\mathcal{E})$ with $(x_1, x_2) \in \mathcal{E}$ iff there exists $y \in Y_\mathcal{M}$ such that $x_2y_2\in\mathcal{M}$ and $x_1y_2\in E(G)$.\\
				Let $X^* = N(Y_U)$. Observe that $G$ has a $\mathcal{M}$-augmenting path iff $D_\mathcal{M}$ has a path from $X_U$ to $X^*$. This is easily resolved by just finding the set of vertices `reachable' from $X_U$ in $D_\mathcal{M}$. This is possible to do efficiently using the \emph{breadth-first-search} (BFS) algorithm, which we shall detail next.
			\end{proof}


			% Let $D = (V,\mathcal{E})$ be a directed graph. For a vertex $u$, let us call $v$ an \emph{out-neighbour} of $u$ if $(u,v)\in\mathcal{E}$, and an \emph{in-neighbour} of $u$ if $(v,u)\in\mathcal{E}$.\\
			The BFS algorithm is as follows.

			\begin{algorithm}[H]
				\DontPrintSemicolon
				\SetNoFillComment		
				\KwIn{A directed graph $D = (V,E)$ and a set $X \subseteq V$.}
				\KwOut{The set of vertices in $D$ reachable from $X$}
				$S\gets X$\;
				$\mathsf{Queue}\; q \gets X$ \tcp*{in any arbitrary order}
				\While{$q\ne\emptyset$} {
					$v \gets \texttt{pop}(q)$\;
					\For{$u\in N(v)$}{
						\If{$u\not\in S$} {
							$S \gets S \cup \{u\}$\;
							$\texttt{push}(q,u)$
						}
					}
				}
				\Return{$S$}
				\caption{BFS algorithm}\label{algo: bfs}
			\end{algorithm}

			If $X = \{v\}$, then this algorithm in fact finds a shortest path from $v$ to every reachable vertex from it. The correctness of the algorithm follows by a simple induction from $v$ to $u$.